# –ê–Ω–∞–ª–∏–∑ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Supabase –ø—Ä–∏ –∑–∞—Ö–æ–¥–µ –Ω–∞ —Å–ø–∏—Å–æ–∫ —Å—É—â–Ω–æ—Å—Ç–µ–π

**–î–∞—Ç–∞:** 2025-01-30  
**–¶–µ–ª—å:** –†–∞–∑–æ–±—Ä–∞—Ç—å –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

---

## üìä –ê–Ω–∞–ª–∏–∑ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –ø–æ—Ä—è–¥–∫—É

### –§–∞–∑–∞ 1: –ó–∞—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–ø–µ—Ä–≤—ã–µ 5 –∑–∞–ø—Ä–æ—Å–æ–≤)

#### –ó–∞–ø—Ä–æ—Å 1: `e1a00076-cb6d-4884-8da6-048b0a281a70?_rsc=1ee8j`

- **–¢–∏–ø:** fetch (React Server Component)
- **–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä:** `UniversalEntityListClient.tsx:205`
- **–†–∞–∑–º–µ—Ä:** 3.2 kB
- **–í—Ä–µ–º—è:** 249 ms
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ —á–µ—Ä–µ–∑ Next.js Server Component. –ü–∞—Ä–∞–º–µ—Ç—Ä `_rsc` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ React Server Components.
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω–æ - —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º Next.js

#### –ó–∞–ø—Ä–æ—Å—ã 2-3: JavaScript —Ñ–∞–π–ª—ã

- **–¢–∏–ø:** script
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö JavaScript —Ñ–∞–π–ª–æ–≤ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω–æ - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ Next.js

#### –ó–∞–ø—Ä–æ—Å 4: `entity_definition?select=*%2Cfield!field_entity_...28*%29&id=eq.e1a00076-cb6d-4884-8da6-048b0a281a70`

- **–¢–∏–ø:** fetch
- **–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä:** `fetch.ts:7`
- **–†–∞–∑–º–µ—Ä:** 2.2 kB
- **–í—Ä–µ–º—è:** 103 ms
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –ó–∞–≥—Ä—É–∑–∫–∞ `entity_definition` —Å –ø–æ–ª—è–º–∏ —á–µ—Ä–µ–∑ JOIN. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ `getEntityDefinitionWithUIConfig()` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω–æ - –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

#### –ó–∞–ø—Ä–æ—Å 5: `entity_definition?select=*%2Cfield!field_entity_...28*%29&id=eq.e1a00076-cb6d-4884-8da6-048b0a281a70`

- **–¢–∏–ø:** fetch
- **–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä:** `fetch.ts:7`
- **–†–∞–∑–º–µ—Ä:** 2.2 kB
- **–í—Ä–µ–º—è:** 226 ms
- **–û–ø–∏—Å–∞–Ω–∏–µ:** **–î–£–ë–õ–ò–ö–ê–¢** –∑–∞–ø—Ä–æ—Å–∞ 4. –ò–¥–µ–Ω—Ç–∏—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ `entity_definition`.
- **–ü—Ä–æ–±–ª–µ–º–∞:** ‚ö†Ô∏è –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
- **–ü—Ä–∏—á–∏–Ω–∞:** –í–æ–∑–º–æ–∂–Ω–æ:
  1. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç (Server Component + Client Component)
  2. –ö—ç—à SDK –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (—Ä–∞–∑–Ω—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã SDK)
  3. React Query –¥–µ–ª–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å

---

### –§–∞–∑–∞ 2: –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–ø–∏—Å–∫–∞ (–æ—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)

#### –ó–∞–ø—Ä–æ—Å 6: `entity_instance?select=*&entity_definition_id=eq.e...32974c37c&order=created_at.desc&offset=0&limit=20`

- **–¢–∏–ø:** fetch
- **–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä:** `fetch.ts:7`
- **–†–∞–∑–º–µ—Ä:** 1.5 kB
- **–í—Ä–µ–º—è:** 87 ms
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ —á–µ—Ä–µ–∑ `getInstances()`. –û—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—Ä–æ—Å –¥–ª—è —Å–ø–∏—Å–∫–∞.
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω–æ - –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞

#### –ó–∞–ø—Ä–æ—Å 7: `entity_relation?select=source_instance_id%2Ctarget..._id=in.%2888f76ee8-d4f3-43b0-a396-0f3afa5322a5%29`

- **–¢–∏–ø:** fetch
- **–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä:** `fetch.ts:7`
- **–†–∞–∑–º–µ—Ä:** 1.2 kB
- **–í—Ä–µ–º—è:** 95 ms
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –ó–∞–≥—Ä—É–∑–∫–∞ relations –¥–ª—è –≤—Å–µ—Ö instances –≤ —Å–ø–∏—Å–∫–µ (batch-–∑–∞–ø—Ä–æ—Å). –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ `getInstances()` –¥–ª—è –ø–æ–ª–µ–π —Å `displayInTable: true`.
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω–æ - –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è relations –≤ —Ç–∞–±–ª–∏—Ü–µ

#### –ó–∞–ø—Ä–æ—Å 8: `entity_instance?select=*&entity_definition_id=eq.e...32974c37c&order=created_at.desc&offset=0&limit=20`

- **–¢–∏–ø:** fetch
- **–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä:** `fetch.ts:7`
- **–†–∞–∑–º–µ—Ä:** 1.5 kB
- **–í—Ä–µ–º—è:** 90 ms
- **–û–ø–∏—Å–∞–Ω–∏–µ:** **–î–£–ë–õ–ò–ö–ê–¢** –∑–∞–ø—Ä–æ—Å–∞ 6. –ò–¥–µ–Ω—Ç–∏—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ `entity_instance`.
- **–ü—Ä–æ–±–ª–µ–º–∞:** ‚ö†Ô∏è –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
- **–ü—Ä–∏—á–∏–Ω–∞:** –í–æ–∑–º–æ–∂–Ω–æ:
  1. React Query –¥–µ–ª–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∏–∑-–∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è queryKey
  2. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏–≤–∞–µ—Ç—Å—è –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `onLoadData` –¥–≤–∞–∂–¥—ã
  3. –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ, –∏ —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

#### –ó–∞–ø—Ä–æ—Å 9: `entity_instance?select=*&id=in.%2817ebb184-55ff-43...2d9b25f%2C0d3e1b8c-0f05-4ae3-bc6f-fea1bab8c5f3%29`

- **–¢–∏–ø:** fetch
- **–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä:** `fetch.ts:7`
- **–†–∞–∑–º–µ—Ä:** 1.2 kB
- **–í—Ä–µ–º—è:** 82 ms
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –ó–∞–≥—Ä—É–∑–∫–∞ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö instances –¥–ª—è relations. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ `getInstances()` –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ relations (—Å—Ç—Ä–æ–∫–∞ 687-701).
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω–æ - –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ relations

#### –ó–∞–ø—Ä–æ—Å 10: `entity_relation?select=source_instance_id%2Ctarget..._id=in.%2888f76ee8-d4f3-43b0-a396-0f3afa5322a5%29`

- **–¢–∏–ø:** fetch
- **–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä:** `fetch.ts:7`
- **–†–∞–∑–º–µ—Ä:** 1.2 kB
- **–í—Ä–µ–º—è:** 88 ms
- **–û–ø–∏—Å–∞–Ω–∏–µ:** **–î–£–ë–õ–ò–ö–ê–¢** –∑–∞–ø—Ä–æ—Å–∞ 7. –ò–¥–µ–Ω—Ç–∏—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ `entity_relation`.
- **–ü—Ä–æ–±–ª–µ–º–∞:** ‚ö†Ô∏è –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
- **–ü—Ä–∏—á–∏–Ω–∞:** –°–≤—è–∑–∞–Ω–æ —Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∑–∞–ø—Ä–æ—Å–∞ 8 - –µ—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã, relations —Ç–æ–∂–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–≤–∞–∂–¥—ã

#### –ó–∞–ø—Ä–æ—Å 11: `entity_definition?select=*%2Cfield!field_entity_...28*%29&id=eq.0de37a7e-d42a-4b51-9f38-a8f616f80d51`

- **–¢–∏–ø:** fetch
- **–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä:** `fetch.ts:7`
- **–†–∞–∑–º–µ—Ä:** 1.7 kB
- **–í—Ä–µ–º—è:** 76 ms
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –ó–∞–≥—Ä—É–∑–∫–∞ `entity_definition` –¥–ª—è **–¥—Ä—É–≥–æ–≥–æ —Ç–∏–ø–∞ —Å—É—â–Ω–æ—Å—Ç–∏** (ID –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ 4-5). –≠—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å –∑–∞–≥—Ä—É–∑–∫–æ–π fields –¥–ª—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö instances (—Å—Ç—Ä–æ–∫–∞ 732-741 –≤ `getInstances()`).
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω–æ - –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è —É–ø–ª–æ—â–µ–Ω–∏—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö instances
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:** –ú–æ–∂–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å fields –¥–ª—è —Ä–∞–∑–Ω—ã—Ö entity_definition_id

#### –ó–∞–ø—Ä–æ—Å 12: `entity_instance?select=*&id=in.%2817ebb184-55ff-43...2d9b25f%2C0d3e1b8c-0f05-4ae3-bc6f-fea1bab8c5f3%29`

- **–¢–∏–ø:** fetch
- **–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä:** `fetch.ts:7`
- **–†–∞–∑–º–µ—Ä:** 1.2 kB
- **–í—Ä–µ–º—è:** 76 ms
- **–û–ø–∏—Å–∞–Ω–∏–µ:** **–î–£–ë–õ–ò–ö–ê–¢** –∑–∞–ø—Ä–æ—Å–∞ 9. –ò–¥–µ–Ω—Ç–∏—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ `entity_instance` –ø–æ ID.
- **–ü—Ä–æ–±–ª–µ–º–∞:** ‚ö†Ô∏è –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
- **–ü—Ä–∏—á–∏–Ω–∞:** –°–≤—è–∑–∞–Ω–æ —Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∑–∞–ø—Ä–æ—Å–∞ 8

#### –ó–∞–ø—Ä–æ—Å 13: `entity_file?select=id%2Centity_instance_id%2Cfield...6dadc7e%2C2b0b3b92-ea9f-4b3c-bec7-a28f81c8e349%29`

- **–¢–∏–ø:** fetch
- **–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä:** `fetch.ts:7`
- **–†–∞–∑–º–µ—Ä:** 1.2 kB
- **–í—Ä–µ–º—è:** 82 ms
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –≤—Å–µ—Ö instances –≤ —Å–ø–∏—Å–∫–µ (batch-–∑–∞–ø—Ä–æ—Å). –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ `getInstances()` –¥–ª—è –ø–æ–ª–µ–π —Ç–∏–ø–∞ `files` –∏–ª–∏ `images`.
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω–æ - –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –≤ —Ç–∞–±–ª–∏—Ü–µ

#### –ó–∞–ø—Ä–æ—Å 14: `entity_file?select=id%2Centity_instance_id%2Cfield...6dadc7e%2C2b0b3b92-ea9f-4b3c-bec7-a28f81c8e349%29`

- **–¢–∏–ø:** fetch
- **–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä:** `fetch.ts:7`
- **–†–∞–∑–º–µ—Ä:** 1.2 kB
- **–í—Ä–µ–º—è:** 108 ms
- **–û–ø–∏—Å–∞–Ω–∏–µ:** **–î–£–ë–õ–ò–ö–ê–¢** –∑–∞–ø—Ä–æ—Å–∞ 13. –ò–¥–µ–Ω—Ç–∏—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ `entity_file`.
- **–ü—Ä–æ–±–ª–µ–º–∞:** ‚ö†Ô∏è –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
- **–ü—Ä–∏—á–∏–Ω–∞:** –°–≤—è–∑–∞–Ω–æ —Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∑–∞–ø—Ä–æ—Å–∞ 8

---

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

**–ù–∞–±–ª—é–¥–µ–Ω–∏—è:**

- –ó–∞–ø—Ä–æ—Å—ã 4 –∏ 5: –¥—É–±–ª–∏–∫–∞—Ç—ã `entity_definition`
- –ó–∞–ø—Ä–æ—Å—ã 6 –∏ 8: –¥—É–±–ª–∏–∫–∞—Ç—ã `entity_instance` (—Å–ø–∏—Å–æ–∫)
- –ó–∞–ø—Ä–æ—Å—ã 7 –∏ 10: –¥—É–±–ª–∏–∫–∞—Ç—ã `entity_relation`
- –ó–∞–ø—Ä–æ—Å—ã 9 –∏ 12: –¥—É–±–ª–∏–∫–∞—Ç—ã `entity_instance` (–ø–æ ID)
- –ó–∞–ø—Ä–æ—Å—ã 13 –∏ 14: –¥—É–±–ª–∏–∫–∞—Ç—ã `entity_file`

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**

1. **React Query –¥–µ–ª–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å**

   - `staleTime: 30s` - –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —Å—á–∏—Ç–∞—é—Ç—Å—è —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏, React Query –¥–µ–ª–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å
   - –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ queryKey React Query –¥–µ–ª–∞–µ—Ç –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
   - –ü—Ä–∏ –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–∑–æ–≤ `queryFn`

2. **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏–≤–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã**

   - Next.js App Router –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –¥–≤–æ–π–Ω–æ–π —Ä–µ–Ω–¥–µ—Ä –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
   - React Strict Mode –≤ development —Ä–µ–∂–∏–º–µ –≤—ã–∑—ã–≤–∞–µ—Ç –¥–≤–æ–π–Ω–æ–π —Ä–µ–Ω–¥–µ—Ä
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ URL –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä

3. **–û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ**

   - –ï—Å–ª–∏ –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç —ç–ª–µ–º–µ–Ω—Ç –≤ –∫—ç—à–µ, –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏ –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
   - `invalidateQueries` –≤—Å–µ –µ—â–µ –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –≥–¥–µ-—Ç–æ –≤ –∫–æ–¥–µ

4. **–†–∞–∑–Ω—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã SDK**
   - Server SDK –∏ Client SDK - —Ä–∞–∑–Ω—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã, –∫—ç—à –Ω–µ —Ä–∞–∑–¥–µ–ª—è–µ—Ç—Å—è
   - –ö–∞–∂–¥—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä SDK –∏–º–µ–µ—Ç —Å–≤–æ–π –∫—ç—à

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

#### 1.1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å React Query –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** React Query –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏–∑-–∑–∞ `staleTime` –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è queryKey.

**–†–µ—à–µ–Ω–∏–µ:**

```typescript
// components/universal-entity-list/hooks/use-list-query.ts
const {
  data: queryResult,
  // ...
} = useQuery({
  queryKey,
  queryFn: async ({ signal }) => {
    return await onLoadData(params, signal);
  },
  staleTime: 30 * 1000, // 30 —Å–µ–∫—É–Ω–¥
  gcTime: 5 * 60 * 1000, // 5 –º–∏–Ω—É—Ç
  enabled: true,
  // –î–æ–±–∞–≤–∏—Ç—å –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
  refetchOnMount: false, // –ù–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—Ç—å –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —Å–≤–µ–∂–∏–µ
  refetchOnWindowFocus: false, // –ù–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—Ç—å –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ –æ–∫–Ω–∞
  refetchOnReconnect: false, // –ù–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—Ç—å –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
  placeholderData: (previousData) => previousData,
});
```

#### 1.2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ `onLoadData` –¥–≤–∞–∂–¥—ã

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å `onLoadData` –¥–≤–∞–∂–¥—ã –∏–∑-–∑–∞ –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∞.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `useRef` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:

```typescript
const hasLoadedRef = useRef(false);
const queryKey = getListQueryKey(projectId, serviceType, params);

useEffect(() => {
  if (!hasLoadedRef.current) {
    hasLoadedRef.current = true;
    console.log("[List Query] First load with key:", queryKey);
  } else {
    console.warn("[List Query] Duplicate load detected with key:", queryKey);
  }
}, [queryKey]);
```

#### 1.3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:** –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–∂–µ—Ç –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç –≤ –∫—ç—à–µ.

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É –≤ `UniversalEntityFormNew.tsx`:

```typescript
onSuccess: (updatedInstance) => {
  if (queryKey && updatedInstance) {
    const allQueries = queryClient.getQueriesData<{
      data: EntityInstanceWithFields[];
      pagination: any;
    }>({
      queryKey: queryKey.slice(0, 3), // ["list", projectId, serviceType]
    });

    console.log("[Optimistic Update] Found queries:", allQueries.length);

    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    allQueries.forEach(([key, queryData]) => {
      // ...
    });
  }
};
```

---

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

#### 2.1. –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å fields –¥–ª—è —Ä–∞–∑–Ω—ã—Ö entity_definition_id

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö instances –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è fields –¥–ª—è –∫–∞–∂–¥–æ–≥–æ `entity_definition_id` –æ—Ç–¥–µ–ª—å–Ω–æ (–∑–∞–ø—Ä–æ—Å 11).

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**

```typescript:732:741:lib/sdk/public-api/client.ts
await Promise.all(
  targetEntityDefinitionIds.map(async (entityDefId) => {
    const targetFields = await this.getFields(entityDefId);
    fieldsMap.set(
      entityDefId,
      targetFields.map((f) => ({
        name: f.name,
        dbType: f.dbType,
      }))
    );
  })
);
```

**–†–µ—à–µ–Ω–∏–µ:** –ö—ç—à SDK —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å:

- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫—ç—à –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ø–∞–¥–∞–Ω–∏–π –≤ –∫—ç—à

#### 2.2. –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã relations –∏ files –≤ –æ–¥–∏–Ω

**–ü—Ä–æ–±–ª–µ–º–∞:** Relations –∏ files –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏.

**–¢–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥:** Batch-–∑–∞–ø—Ä–æ—Å—ã —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, –Ω–æ –º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–ª—å—à–µ:

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å —Å JOIN (–µ—Å–ª–∏ Supabase –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç)
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å RPC —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

---

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –£–ª—É—á—à–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

#### 3.1. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫—ç—à SDK —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–ø–∏—Å–∫–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–ø–∏—Å–∫–∞ `enableCache: true`, –Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ —Ä–∞–≤–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç.

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**

```typescript:42:43:app/projects/[projectId]/[entityDefId]/page.tsx
{
  enableCache: true, // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
}
```

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

```typescript
// –í base-client.ts
async getEntityDefinitionConfig(entityDefinitionId: string) {
  const cached = this.configCache.get(entityDefinitionId);
  if (cached && Date.now() < cached.expiresAt) {
    console.log('[SDK Cache] HIT for entity_definition:', entityDefinitionId);
    return cached.config;
  }
  console.log('[SDK Cache] MISS for entity_definition:', entityDefinitionId);
  // ...
}
```

#### 3.2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—â–∏–π –∫—ç—à –º–µ–∂–¥—É Server –∏ Client SDK

**–ü—Ä–æ–±–ª–µ–º–∞:** Server SDK –∏ Client SDK - —Ä–∞–∑–Ω—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã, –∫—ç—à –Ω–µ —Ä–∞–∑–¥–µ–ª—è–µ—Ç—Å—è.

**–†–µ—à–µ–Ω–∏–µ:** –≠—Ç–æ —Å–ª–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å, –Ω–æ –º–æ–∂–Ω–æ:

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–π –∫—ç—à (Redis, Memory cache)
- –ò–ª–∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∫—ç—à —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç

---

## üìã –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### –®–∞–≥ 1: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

1. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `useListQuery` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤—ã–∑–æ–≤–æ–≤
2. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `getInstances` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ `onLoadData` –¥–≤–∞–∂–¥—ã

### –®–∞–≥ 2: –ò—Å–ø—Ä–∞–≤–∏—Ç—å React Query –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

1. –î–æ–±–∞–≤–∏—Ç—å `refetchOnMount: false` –∏ –¥—Ä—É–≥–∏–µ —Ñ–ª–∞–≥–∏
2. –£–≤–µ–ª–∏—á–∏—Ç—å `staleTime` –¥–æ 60 —Å–µ–∫—É–Ω–¥ –¥–ª—è —Å–ø–∏—Å–∫–æ–≤
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ queryKey —Å—Ç–∞–±–∏–ª–µ–Ω

### –®–∞–≥ 3: –£–ª—É—á—à–∏—Ç—å –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

1. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã
2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫—ç—à–µ
3. –î–æ–±–∞–≤–∏—Ç—å fallback –Ω–∞ `invalidateQueries` –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω

### –®–∞–≥ 4: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

1. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫—ç—à SDK —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è fields
2. –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ RPC —Ñ—É–Ω–∫—Ü–∏—é

---

## –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**

- 14 –∑–∞–ø—Ä–æ—Å–æ–≤ (–∏–∑ –Ω–∏—Ö 5 –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)
- –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏: ~1-1.5 —Å–µ–∫—É–Ω–¥—ã

**–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π:**

- 7-9 –∑–∞–ø—Ä–æ—Å–æ–≤ (–±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)
- –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏: ~0.5-0.8 —Å–µ–∫—É–Ω–¥—ã
- –≠–∫–æ–Ω–æ–º–∏—è: ~40-50% –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –≤—Ä–µ–º–µ–Ω–∏
