# –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—É–±–ª–∏—á–Ω–æ–≥–æ API

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-01-29  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π

## üìã –û–±–∑–æ—Ä

–°–æ–∑–¥–∞–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ REST API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å `entityInstance` —á–µ—Ä–µ–∑ `entityDefinition`, —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —É—Å–ª–æ–≤–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –≤ `entity_definition`.

**–í–∞–∂–Ω–æ:** –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ rate limiting (–æ—Ç–ª–æ–∂–µ–Ω–æ –Ω–∞ –±—É–¥—É—â–µ–µ). –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∏–¥–µ—Ç –Ω–∞–ø—Ä—è–º—É—é –≤ Supabase.

---

## üéØ –¶–µ–ª–∏

1. –ü—É–±–ª–∏—á–Ω—ã–π API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏ —Å—É—â–Ω–æ—Å—Ç–µ–π
2. –£—Å–ª–æ–≤–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –≤ `entity_definition`
3. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö CRUD –æ–ø–µ—Ä–∞—Ü–∏–π
4. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤ –∏ —Å–≤—è–∑–µ–π
5. –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (sign-in, sign-up, OAuth, password reset)

---

## üìê –°—Ç—Ä—É–∫—Ç—É—Ä–∞ API

### Endpoint Pattern

```
GET    /api/public/[projectId]/[entityDefinitionId]           - —Å–ø–∏—Å–æ–∫ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤
GET    /api/public/[projectId]/[entityDefinitionId]/[id]       - –æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä
POST   /api/public/[projectId]/[entityDefinitionId]           - —Å–æ–∑–¥–∞—Ç—å (–µ—Å–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ)
PUT    /api/public/[projectId]/[entityDefinitionId]/[id]       - –æ–±–Ω–æ–≤–∏—Ç—å (–µ—Å–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ)
DELETE /api/public/[projectId]/[entityDefinitionId]/[id]       - —É–¥–∞–ª–∏—Ç—å (–µ—Å–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ)

POST   /api/public/[projectId]/auth/sign-in                   - –≤—Ö–æ–¥
POST   /api/public/[projectId]/auth/sign-up                   - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
POST   /api/public/[projectId]/auth/sign-out                  - –≤—ã—Ö–æ–¥
POST   /api/public/[projectId]/auth/oauth/google              - OAuth Google (–∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–∏–µ)
GET    /api/public/[projectId]/auth/callback                  - OAuth callback
POST   /api/public/[projectId]/auth/forgot-password           - –∑–∞–ø—Ä–æ—Å —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
POST   /api/public/[projectId]/auth/reset-password            - —Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è
GET    /api/public/[projectId]/auth/me                       - —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
```

---

## üì¶ –≠—Ç–∞–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ Supabase (2-3 —á–∞—Å–∞)

#### 1.1. –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

**–§–∞–π–ª:** `lib/api/public/project-loader.ts`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**

```typescript
import { createClient } from '@/lib/supabase/server';
import type { Project, EntityDefinition, Field } from '@/lib/universal-entity/types';

export interface ProjectWithConfig {
  project: Project & {
    enableSignIn: boolean;
    enableSignUp: boolean;
  };
  entityDefinitions: Array<EntityDefinition & {
    fields: Field[];
  }>;
}

/**
 * –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–µ–∫—Ç —Å–æ –≤—Å–µ–º–∏ entityDefinitions –∏ fields –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
 * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—É–±–ª–∏—á–Ω–æ–º API –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
 * 
 * @param projectId - ID –ø—Ä–æ–µ–∫—Ç–∞
 * @returns –ü—Ä–æ–µ–∫—Ç —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –∏–ª–∏ null –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω
 */
export async function getProjectWithConfig(
  projectId: string
): Promise<ProjectWithConfig | null>
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –û–¥–∏–Ω –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ —á–µ—Ä–µ–∑ Supabase
- –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ snake_case –≤ camelCase
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –ø–æ–ª–µ–π entityDefinition –∏ field
- –í–æ–∑–≤—Ä–∞—Ç null –µ—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- `lib/supabase/server` - –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞
- `lib/universal-entity/types` - –¥–ª—è —Ç–∏–ø–æ–≤

---

### –≠—Ç–∞–ø 2: Middleware –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (3-4 —á–∞—Å–∞)

#### 2.1. –°–æ–∑–¥–∞—Ç—å middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

**–§–∞–π–ª:** `lib/api/public/auth-middleware.ts`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**

```typescript
import { NextRequest } from 'next/server';
import { createClient } from '@/lib/supabase/server';

export interface AuthResult {
  user: { id: string; email: string } | null;
  role: 'admin' | 'user' | null;
}

/**
 * –ò–∑–≤–ª–µ—á—å –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å JWT —Ç–æ–∫–µ–Ω –∏–∑ –∑–∞–ø—Ä–æ—Å–∞
 * 
 * @param request - Next.js request –æ–±—ä–µ–∫—Ç
 * @returns –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏ —Ä–æ–ª—å—é
 */
export async function getAuthFromRequest(
  request: NextRequest
): Promise<AuthResult>

/**
 * –ü–æ–ª—É—á–∏—Ç—å —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
 * 
 * @param userId - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 * @returns –†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ('admin' | 'user' | null)
 */
async function getUserRole(userId: string): Promise<'admin' | 'user' | null>
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Bearer token –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ Authorization
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ Supabase Auth
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –í–æ–∑–≤—Ä–∞—Ç null –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- `lib/supabase/server` - –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞
- `lib/auth/roles` - –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–æ–ª–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)

---

### –≠—Ç–∞–ø 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (2-3 —á–∞—Å–∞)

#### 3.1. –°–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π

**–§–∞–π–ª:** `lib/api/public/permission-checker.ts`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**

```typescript
import type { EntityDefinition } from '@/lib/universal-entity/types';
import { getAuthFromRequest, type AuthResult } from './auth-middleware';
import { NextRequest } from 'next/server';

export type PermissionType = 'create' | 'read' | 'update' | 'delete';

export interface PermissionCheckResult {
  allowed: boolean;
  reason?: string;
}

/**
 * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –¥–ª—è entityDefinition
 * 
 * @param request - Next.js request –æ–±—ä–µ–∫—Ç
 * @param entityDefinition - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å—É—â–Ω–æ—Å—Ç–∏
 * @param permission - –¢–∏–ø —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è (create, read, update, delete)
 * @param ownerId - ID –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∑–∞–ø–∏—Å–∏ (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Owner —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π)
 * @returns –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
 */
export async function checkPermission(
  request: NextRequest,
  entityDefinition: EntityDefinition,
  permission: PermissionType,
  ownerId?: string | null
): Promise<PermissionCheckResult>
```

**–õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

1. **ALL** - –¥–æ—Å—Ç—É–ø–Ω–æ –≤—Å–µ–º (–≤–∫–ª—é—á–∞—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö)
2. **User** - —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–ª—é–±–æ–π –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
3. **Admin** - —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–æ–ª—å admin
4. **Admin|User** - —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (admin –∏–ª–∏ user)
5. **Owner** - —Ç—Ä–µ–±—É–µ—Ç—Å—è –±—ã—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –∑–∞–ø–∏—Å–∏
6. **Owner|Admin** - —Ç—Ä–µ–±—É–µ—Ç—Å—è –±—ã—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –∏–ª–∏ admin
7. **Owner|User** - —Ç—Ä–µ–±—É–µ—Ç—Å—è –±—ã—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –∏–ª–∏ –ª—é–±—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Owner –ø—Ä–æ–≤–µ—Ä–∫–∏ —á–µ—Ä–µ–∑ ownerId
- –í–æ–∑–≤—Ä–∞—Ç –ø–æ–Ω—è—Ç–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- `lib/api/public/auth-middleware` - –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `lib/universal-entity/types` - –¥–ª—è —Ç–∏–ø–æ–≤

---

### –≠—Ç–∞–ø 4: API Routes –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏ (2-3 –¥–Ω—è)

#### 4.1. GET —Å–ø–∏—Å–æ–∫ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤

**–§–∞–π–ª:** `app/api/public/[projectId]/[entityDefinitionId]/route.ts`

**–ú–µ—Ç–æ–¥:** GET

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `page` (number, optional) - –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1)
- `limit` (number, optional) - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20)
- `search` (string, optional) - –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
- `filters` (JSON, optional) - —Ñ–∏–ª—å—Ç—Ä—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ `{ fieldName: [values] }`
- `includeRelations` (string[], optional) - —Å–ø–∏—Å–æ–∫ –ø–æ–ª–µ–π –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–≤—è–∑–µ–π
- `sortBy` (string, optional) - –ø–æ–ª–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
- `sortOrder` (string, optional) - –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ ('asc' | 'desc')

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**

1. –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ `getProjectWithConfig`
2. –ü–æ–∏—Å–∫ entityDefinition –ø–æ ID
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ `readPermission` —á–µ—Ä–µ–∑ `checkPermission`
4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `getInstances` –∏–∑ `instance-service`
5. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤, –ø–∞–≥–∏–Ω–∞—Ü–∏–∏, –ø–æ–∏—Å–∫–∞
6. –ó–∞–≥—Ä—É–∑–∫–∞ —Å–≤—è–∑–µ–π –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ `includeRelations`
7. –í–æ–∑–≤—Ä–∞—Ç –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON

**–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:**

```json
{
  "data": [
    {
      "id": "...",
      "entityDefinitionId": "...",
      "projectId": "...",
      "field1": "value1",
      "field2": "value2",
      "relations": {
        "fieldName": [...]
      },
      "createdAt": "...",
      "updatedAt": "..."
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 100,
    "totalPages": 5,
    "hasPreviousPage": false,
    "hasNextPage": true
  }
}
```

**–û—à–∏–±–∫–∏:**
- 404 - –ø—Ä–æ–µ–∫—Ç –∏–ª–∏ entityDefinition –Ω–µ –Ω–∞–π–¥–µ–Ω
- 403 - –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ (readPermission –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç)
- 401 - —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

---

#### 4.2. GET –æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä

**–§–∞–π–ª:** `app/api/public/[projectId]/[entityDefinitionId]/[id]/route.ts`

**–ú–µ—Ç–æ–¥:** GET

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `includeRelations` (string[], optional) - —Å–ø–∏—Å–æ–∫ –ø–æ–ª–µ–π –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–≤—è–∑–µ–π

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**

1. –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
2. –ü–æ–∏—Å–∫ entityDefinition –ø–æ ID
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ `readPermission`
4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `getInstanceById` –∏–∑ `instance-service`
5. –ó–∞–≥—Ä—É–∑–∫–∞ —Å–≤—è–∑–µ–π –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ `includeRelations`
6. –í–æ–∑–≤—Ä–∞—Ç –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON

**–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:**

```json
{
  "id": "...",
  "entityDefinitionId": "...",
  "projectId": "...",
  "field1": "value1",
  "field2": "value2",
  "relations": {
    "fieldName": [...]
  },
  "createdAt": "...",
  "updatedAt": "..."
}
```

**–û—à–∏–±–∫–∏:**
- 404 - –ø—Ä–æ–µ–∫—Ç, entityDefinition –∏–ª–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω
- 403 - –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞
- 401 - —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

---

#### 4.3. POST —Å–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä

**–§–∞–π–ª:** `app/api/public/[projectId]/[entityDefinitionId]/route.ts`

**–ú–µ—Ç–æ–¥:** POST

**Body (JSON):**

```json
{
  "data": {
    "field1": "value1",
    "field2": "value2"
  },
  "relations": {
    "fieldName": ["instanceId1", "instanceId2"]
  },
  "files": {
    "fieldName": [File]
  }
}
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**

1. –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
2. –ü–æ–∏—Å–∫ entityDefinition –ø–æ ID
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ `createPermission`
4. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –æ—Å–Ω–æ–≤–µ fields –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
5. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤ (–µ—Å–ª–∏ –µ—Å—Ç—å file –ø–æ–ª—è) —á–µ—Ä–µ–∑ `file-service`
6. –°–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ —á–µ—Ä–µ–∑ `createInstance` –∏–∑ `instance-service`
7. –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–µ–π (–µ—Å–ª–∏ –µ—Å—Ç—å relations)
8. –í–æ–∑–≤—Ä–∞—Ç —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö required –ø–æ–ª–µ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ multipart/form-data
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ `created_by` –∏–∑ —Ç–æ–∫–µ–Ω–∞

**–û—à–∏–±–∫–∏:**
- 404 - –ø—Ä–æ–µ–∫—Ç –∏–ª–∏ entityDefinition –Ω–µ –Ω–∞–π–¥–µ–Ω
- 403 - –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ (createPermission –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç)
- 401 - —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- 400 - –æ—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

---

#### 4.4. PUT –æ–±–Ω–æ–≤–∏—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä

**–§–∞–π–ª:** `app/api/public/[projectId]/[entityDefinitionId]/[id]/route.ts`

**–ú–µ—Ç–æ–¥:** PUT

**Body (JSON):**

```json
{
  "data": {
    "field1": "newValue1",
    "field2": "newValue2"
  },
  "relations": {
    "fieldName": ["instanceId1", "instanceId2"]
  },
  "files": {
    "fieldName": [File]
  }
}
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**

1. –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
2. –ü–æ–∏—Å–∫ entityDefinition –ø–æ ID
3. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ `updatePermission`
5. –ü—Ä–æ–≤–µ—Ä–∫–∞ Owner (–µ—Å–ª–∏ `updatePermission` —Å–æ–¥–µ—Ä–∂–∏—Ç Owner)
6. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
7. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤ (—É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö, –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤—ã—Ö)
8. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `updateInstance` –∏–∑ `instance-service`
9. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑–µ–π
10. –í–æ–∑–≤—Ä–∞—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ Owner —á–µ—Ä–µ–∑ `created_by` –∏–∑ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞
- –ß–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—è)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ (–µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω–æ null)

**–û—à–∏–±–∫–∏:**
- 404 - –ø—Ä–æ–µ–∫—Ç, entityDefinition –∏–ª–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω
- 403 - –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∏–ª–∏ –Ω–µ –≤–ª–∞–¥–µ–ª–µ—Ü
- 401 - —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- 400 - –æ—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

---

#### 4.5. DELETE —É–¥–∞–ª–∏—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä

**–§–∞–π–ª:** `app/api/public/[projectId]/[entityDefinitionId]/[id]/route.ts`

**–ú–µ—Ç–æ–¥:** DELETE

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**

1. –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
2. –ü–æ–∏—Å–∫ entityDefinition –ø–æ ID
3. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ `deletePermission`
5. –ü—Ä–æ–≤–µ—Ä–∫–∞ Owner (–µ—Å–ª–∏ `deletePermission` —Å–æ–¥–µ—Ä–∂–∏—Ç Owner)
6. –£–¥–∞–ª–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑ Storage —á–µ—Ä–µ–∑ `file-service`
7. –£–¥–∞–ª–µ–Ω–∏–µ —Å–≤—è–∑–µ–π —á–µ—Ä–µ–∑ `relation-service`
8. –£–¥–∞–ª–µ–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞
9. –í–æ–∑–≤—Ä–∞—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –û—á–∏—Å—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤ –∏–∑ Storage

**–û—à–∏–±–∫–∏:**
- 404 - –ø—Ä–æ–µ–∫—Ç, entityDefinition –∏–ª–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω
- 403 - –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∏–ª–∏ –Ω–µ –≤–ª–∞–¥–µ–ª–µ—Ü
- 401 - —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

---

### –≠—Ç–∞–ø 5: API Routes –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (1-2 –¥–Ω—è)

#### 5.1. POST /api/public/[projectId]/auth/sign-in

**–§–∞–π–ª:** `app/api/public/[projectId]/auth/sign-in/route.ts`

**Body (JSON):**

```json
{
  "email": "user@example.com",
  "password": "password123"
}
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**

1. –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ —á–µ—Ä–µ–∑ `getProjectWithConfig`
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ `enable_sign_in` –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–æ–µ–∫—Ç–∞
3. –í–∞–ª–∏–¥–∞—Ü–∏—è email/password
4. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Supabase Auth: `supabase.auth.signInWithPassword()`
5. –í–æ–∑–≤—Ä–∞—Ç JWT —Ç–æ–∫–µ–Ω–∞ –∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:**

```json
{
  "accessToken": "jwt_token_here",
  "user": {
    "id": "...",
    "email": "user@example.com"
  }
}
```

**–û—à–∏–±–∫–∏:**
- 404 - –ø—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω
- 403 - sign-in –æ—Ç–∫–ª—é—á–µ–Ω –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞
- 401 - –Ω–µ–≤–µ—Ä–Ω—ã–µ credentials
- 400 - –æ—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

---

#### 5.2. POST /api/public/[projectId]/auth/sign-up

**–§–∞–π–ª:** `app/api/public/[projectId]/auth/sign-up/route.ts`

**Body (JSON):**

```json
{
  "email": "user@example.com",
  "password": "password123",
  "firstName": "John",
  "lastName": "Doe"
}
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**

1. –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ —á–µ—Ä–µ–∑ `getProjectWithConfig`
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ `enable_sign_up` –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–æ–µ–∫—Ç–∞
3. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
4. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ Supabase Auth: `supabase.auth.signUp()`
5. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è (—á–µ—Ä–µ–∑ —Ç—Ä–∏–≥–≥–µ—Ä –≤ –ë–î)
6. –í–æ–∑–≤—Ä–∞—Ç JWT —Ç–æ–∫–µ–Ω–∞ –∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:**

```json
{
  "accessToken": "jwt_token_here",
  "user": {
    "id": "...",
    "email": "user@example.com"
  }
}
```

**–û—à–∏–±–∫–∏:**
- 404 - –ø—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω
- 403 - sign-up –æ—Ç–∫–ª—é—á–µ–Ω –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞
- 400 - –æ—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏–ª–∏ email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

---

#### 5.3. POST /api/public/[projectId]/auth/sign-out

**–§–∞–π–ª:** `app/api/public/[projectId]/auth/sign-out/route.ts`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**

1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ `getAuthFromRequest`
2. –í—ã—Ö–æ–¥ —á–µ—Ä–µ–∑ Supabase Auth: `supabase.auth.signOut()`
3. –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏
4. –í–æ–∑–≤—Ä–∞—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞

**–û—à–∏–±–∫–∏:**
- 401 - –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

---

#### 5.4. POST /api/public/[projectId]/auth/oauth/google

**–§–∞–π–ª:** `app/api/public/[projectId]/auth/oauth/google/route.ts`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**

1. –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ —á–µ—Ä–µ–∑ `getProjectWithConfig`
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ `enable_sign_in` –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–æ–µ–∫—Ç–∞
3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è OAuth URL —á–µ—Ä–µ–∑ Supabase Admin API
4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ callback URL: `/api/public/[projectId]/auth/callback`
5. –í–æ–∑–≤—Ä–∞—Ç redirect URL –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞

**–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:**

```json
{
  "redirectUrl": "https://supabase.co/auth/v1/authorize?..."
}
```

**–û—à–∏–±–∫–∏:**
- 404 - –ø—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω
- 403 - sign-in –æ—Ç–∫–ª—é—á–µ–Ω –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞

---

#### 5.5. GET /api/public/[projectId]/auth/callback

**–§–∞–π–ª:** `app/api/public/[projectId]/auth/callback/route.ts`

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `code` (string, required) - –∫–æ–¥ –æ—Ç OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**

1. –ü–æ–ª—É—á–µ–Ω–∏–µ `code` –∏–∑ query –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
2. –û–±–º–µ–Ω code –Ω–∞ —Å–µ—Å—Å–∏—é —á–µ—Ä–µ–∑ Supabase: `supabase.auth.exchangeCodeForSession()`
3. –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—á–µ—Ä–µ–∑ —Ç—Ä–∏–≥–≥–µ—Ä)
4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–∞
5. –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –∫–ª–∏–µ–Ω—Ç —Å —Ç–æ–∫–µ–Ω–æ–º –≤ query –ø–∞—Ä–∞–º–µ—Ç—Ä–µ –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—Ç JSON

**–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (JSON):**

```json
{
  "accessToken": "jwt_token_here",
  "user": {
    "id": "...",
    "email": "user@example.com"
  }
}
```

**–û—à–∏–±–∫–∏:**
- 400 - –Ω–µ–≤–µ—Ä–Ω—ã–π –∏–ª–∏ –∏—Å—Ç–µ–∫—à–∏–π code
- 500 - –æ—à–∏–±–∫–∞ –æ–±–º–µ–Ω–∞ code –Ω–∞ —Å–µ—Å—Å–∏—é

---

#### 5.6. POST /api/public/[projectId]/auth/forgot-password

**–§–∞–π–ª:** `app/api/public/[projectId]/auth/forgot-password/route.ts`

**Body (JSON):**

```json
{
  "email": "user@example.com"
}
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**

1. –í–∞–ª–∏–¥–∞—Ü–∏—è email
2. –û—Ç–ø—Ä–∞–≤–∫–∞ email –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è —á–µ—Ä–µ–∑ Supabase: `supabase.auth.resetPasswordForEmail()`
3. –í–æ–∑–≤—Ä–∞—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ (–±–µ–∑ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è email)

**–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:**

```json
{
  "message": "If an account exists, a password reset email has been sent"
}
```

**–û—à–∏–±–∫–∏:**
- 400 - –æ—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ email

---

#### 5.7. POST /api/public/[projectId]/auth/reset-password

**–§–∞–π–ª:** `app/api/public/[projectId]/auth/reset-password/route.ts`

**Body (JSON):**

```json
{
  "token": "reset_token_from_email",
  "newPassword": "newPassword123"
}
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**

1. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ –∏ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è
2. –°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è —á–µ—Ä–µ–∑ Supabase: `supabase.auth.updateUser()`
3. –í–æ–∑–≤—Ä–∞—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞

**–û—à–∏–±–∫–∏:**
- 400 - –Ω–µ–≤–µ—Ä–Ω—ã–π –∏–ª–∏ –∏—Å—Ç–µ–∫—à–∏–π —Ç–æ–∫–µ–Ω
- 400 - –æ—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–∞—Ä–æ–ª—è

---

#### 5.8. GET /api/public/[projectId]/auth/me

**–§–∞–π–ª:** `app/api/public/[projectId]/auth/me/route.ts`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**

1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ `getAuthFromRequest`
2. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è
3. –í–æ–∑–≤—Ä–∞—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:**

```json
{
  "id": "...",
  "email": "user@example.com",
  "firstName": "John",
  "lastName": "Doe",
  "role": "user"
}
```

**–û—à–∏–±–∫–∏:**
- 401 - –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

---

### –≠—Ç–∞–ø 6: –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (1 –¥–µ–Ω—å)

#### 6.1. –°–æ–∑–¥–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –¥–∞–Ω–Ω—ã—Ö

**–§–∞–π–ª:** `lib/api/public/validator.ts`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**

```typescript
import type { Field } from '@/lib/universal-entity/types';

export interface ValidationResult {
  valid: boolean;
  errors: Array<{
    field: string;
    message: string;
  }>;
}

/**
 * –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –æ—Å–Ω–æ–≤–µ fields –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
 * 
 * @param data - –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
 * @param fields - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–ª–µ–π
 * @returns –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏
 */
export function validateInstanceData(
  data: Record<string, unknown>,
  fields: Field[]
): ValidationResult
```

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- Required –ø–æ–ª—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
- –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç dbType
- –°—Ç—Ä–æ–∫–æ–≤—ã–µ –ø–æ–ª—è –Ω–µ –ø—Ä–µ–≤—ã—à–∞—é—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–ª–∏–Ω—É
- –ß–∏—Å–ª–æ–≤—ã–µ –ø–æ–ª—è –≤ –¥–æ–ø—É—Å—Ç–∏–º–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ
- –î–∞—Ç–∞ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
- Boolean –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

---

#### 6.2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–§–∞–π–ª:** `lib/api/public/error-handler.ts`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**

```typescript
export class PublicAPIError extends Error {
  constructor(
    public statusCode: number,
    public code: string,
    message: string,
    public details?: unknown
  ) {
    super(message);
  }
}

/**
 * –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
 */
export function formatError(error: unknown): {
  error: {
    code: string;
    message: string;
    details?: unknown;
  };
  statusCode: number;
}
```

**–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–æ–¥—ã –æ—à–∏–±–æ–∫:**
- `PROJECT_NOT_FOUND` - –ø—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω
- `ENTITY_DEFINITION_NOT_FOUND` - entityDefinition –Ω–µ –Ω–∞–π–¥–µ–Ω
- `INSTANCE_NOT_FOUND` - —ç–∫–∑–µ–º–ø–ª—è—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω
- `PERMISSION_DENIED` - –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞
- `AUTHENTICATION_REQUIRED` - —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- `VALIDATION_ERROR` - –æ—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- `SIGN_IN_DISABLED` - –≤—Ö–æ–¥ –æ—Ç–∫–ª—é—á–µ–Ω –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞
- `SIGN_UP_DISABLED` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
lib/api/public/
‚îú‚îÄ‚îÄ project-loader.ts          # –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
‚îú‚îÄ‚îÄ auth-middleware.ts         # Middleware –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ permission-checker.ts     # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
‚îú‚îÄ‚îÄ validator.ts              # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
‚îî‚îÄ‚îÄ error-handler.ts          # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

app/api/public/
‚îú‚îÄ‚îÄ [projectId]/
‚îÇ   ‚îú‚îÄ‚îÄ [entityDefinitionId]/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ route.ts          # GET —Å–ø–∏—Å–æ–∫, POST —Å–æ–∑–¥–∞—Ç—å
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [id]/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ route.ts      # GET –æ–¥–∏–Ω, PUT –æ–±–Ω–æ–≤–∏—Ç—å, DELETE —É–¥–∞–ª–∏—Ç—å
‚îÇ   ‚îî‚îÄ‚îÄ auth/
‚îÇ       ‚îú‚îÄ‚îÄ sign-in/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ route.ts
‚îÇ       ‚îú‚îÄ‚îÄ sign-up/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ route.ts
‚îÇ       ‚îú‚îÄ‚îÄ sign-out/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ route.ts
‚îÇ       ‚îú‚îÄ‚îÄ oauth/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ google/
‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ route.ts
‚îÇ       ‚îú‚îÄ‚îÄ callback/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ route.ts
‚îÇ       ‚îú‚îÄ‚îÄ forgot-password/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ route.ts
‚îÇ       ‚îú‚îÄ‚îÄ reset-password/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ route.ts
‚îÇ       ‚îî‚îÄ‚îÄ me/
‚îÇ           ‚îî‚îÄ‚îÄ route.ts
```

---

## üîÑ –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–≠—Ç–∞–ø 1:** –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π (2-3 —á–∞—Å–∞)
2. **–≠—Ç–∞–ø 2:** Middleware –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (3-4 —á–∞—Å–∞)
3. **–≠—Ç–∞–ø 3:** –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (2-3 —á–∞—Å–∞)
4. **–≠—Ç–∞–ø 4:** API Routes –¥–ª—è —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ (2-3 –¥–Ω—è)
   - 4.1. GET —Å–ø–∏—Å–æ–∫
   - 4.2. GET –æ–¥–∏–Ω
   - 4.3. POST —Å–æ–∑–¥–∞—Ç—å
   - 4.4. PUT –æ–±–Ω–æ–≤–∏—Ç—å
   - 4.5. DELETE —É–¥–∞–ª–∏—Ç—å
5. **–≠—Ç–∞–ø 5:** API Routes –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (1-2 –¥–Ω—è)
   - 5.1. POST sign-in
   - 5.2. POST sign-up
   - 5.3. POST sign-out
   - 5.4. POST oauth/google
   - 5.5. GET callback
   - 5.6. POST forgot-password
   - 5.7. POST reset-password
   - 5.8. GET me
6. **–≠—Ç–∞–ø 6:** –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (1 –¥–µ–Ω—å)

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [ ] –§—É–Ω–∫—Ü–∏—è `getProjectWithConfig` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] Middleware –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–æ–∫–µ–Ω –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ (ALL, User, Admin, Owner, –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏)
- [ ] GET —Å–ø–∏—Å–æ–∫ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π, –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π, –ø–æ–∏—Å–∫–æ–º
- [ ] GET –æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π includeRelations
- [ ] POST —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π, —Ñ–∞–π–ª–∞–º–∏ –∏ —Å–≤—è–∑—è–º–∏
- [ ] PUT –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π Owner
- [ ] DELETE —É–¥–∞–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∫–∞—Å–∫–∞–¥–Ω—ã–º —É–¥–∞–ª–µ–Ω–∏–µ–º
- [ ] –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–∞

---

## üìù –ó–∞–º–µ—Ç–∫–∏

- **–ë–µ–∑ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:** –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∏–¥–µ—Ç –Ω–∞–ø—Ä—è–º—É—é –≤ Supabase
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å:** –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ + entityDefinitions + fields
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π:** –£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤—Å–µ –æ–ø—Ü–∏–∏, –≤–∫–ª—é—á–∞—è Owner
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º `file-service`
- **–°–≤—è–∑–∏:** –ü–æ–¥–¥–µ—Ä–∂–∫–∞ relations —á–µ—Ä–µ–∑ `relation-service`
- **–í–∞–ª–∏–¥–∞—Ü–∏—è:** –ù–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ fields –∏–∑ –ë–î

---

## üîó –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- `lib/supabase/server` - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Supabase
- `lib/universal-entity/instance-service` - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏
- `lib/universal-entity/relation-service` - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å–≤—è–∑—è–º–∏
- `lib/storage/file-service` - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏
- `lib/universal-entity/types` - –¥–ª—è —Ç–∏–ø–æ–≤
- `lib/auth/roles` - –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å–ª–∏ –µ—Å—Ç—å)

---

**–ì–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏!** üöÄ

