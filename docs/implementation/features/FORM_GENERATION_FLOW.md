# –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–æ—Ä–º

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ö–æ–Ω—Ü–µ–ø—Ü–∏—è](#–∫–æ–Ω—Ü–µ–ø—Ü–∏—è)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. [–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö](#–ø–æ—Ç–æ–∫-–¥–∞–Ω–Ω—ã—Ö)
4. [–†–µ–∞–ª–∏–∑–∞—Ü–∏—è](#—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
5. [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

---

## –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–æ—Ä–º –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –ª—é–±—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –±–µ–∑ –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–≥–æ –∫–æ–¥–∞ –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ–æ—Ä–º—ã. –í—Å—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –≤ –≤–∏–¥–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (`EntityDefinition` –∏ `Field`).

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

1. **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã**: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–æ—Ä–º—ã –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –≤ –ë–î
2. **–ï–¥–∏–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º**: –û–¥–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
3. **–°–µ–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–æ–ª—è –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –≤ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–¥–µ–ª—ã
4. **–£—Å–ª–æ–≤–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å**: –ü–æ–ª—è –º–æ–≥—É—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è/—Å–∫—Ä—ã–≤–∞—Ç—å—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–Ω–∞—á–µ–Ω–∏–π –¥—Ä—É–≥–∏—Ö –ø–æ–ª–µ–π
5. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è**: –°—Ö–µ–º–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
6. **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ TypeScript

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–æ—Ä–º –¥–ª—è –ª—é–±–æ–π —Å—É—â–Ω–æ—Å—Ç–∏
- ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã –Ω–∞ —Å–µ–∫—Ü–∏–∏ (–¥–æ 4 —Å–µ–∫—Ü–∏–π)
- ‚úÖ –ö–∞—Å—Ç–æ–º–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Å–µ–∫—Ü–∏–π
- ‚úÖ –£—Å–ª–æ–≤–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å –ø–æ–ª–µ–π (–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –¥—Ä—É–≥–∏—Ö –ø–æ–ª–µ–π)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è (Yup + react-hook-form)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –ø–æ–ª–µ–π (text, number, boolean, date, select, relation)
- ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –æ–ø—Ü–∏–π –¥–ª—è relation-–ø–æ–ª–µ–π
- ‚úÖ –†–µ–∂–∏–º—ã —Å–æ–∑–¥–∞–Ω–∏—è –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—É—Å—Ç—ã—Ö —Å–µ–∫—Ü–∏–π

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
lib/form-generation/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ FormWithSections.tsx       # –ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ñ–æ—Ä–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ GetInputForField.tsx       # –†–æ—É—Ç–µ—Ä –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ input
‚îÇ   ‚îî‚îÄ‚îÄ inputs/
‚îÇ       ‚îú‚îÄ‚îÄ InputText.tsx          # –¢–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è
‚îÇ       ‚îú‚îÄ‚îÄ InputNumber.tsx        # –ß–∏—Å–ª–æ–≤—ã–µ –ø–æ–ª—è
‚îÇ       ‚îú‚îÄ‚îÄ InputSwitch.tsx        # Boolean –ø–æ–ª—è
‚îÇ       ‚îú‚îÄ‚îÄ InputDate.tsx          # –ü–æ–ª—è –¥–∞—Ç
‚îÇ       ‚îú‚îÄ‚îÄ InputSelect.tsx        # Select (single/multiple)
‚îÇ       ‚îî‚îÄ‚îÄ InputRelation.tsx      # Relation –ø–æ–ª—è
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ createSchema.ts            # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Yup —Å—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ getItemForEdit.ts          # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ createFormStructure.ts     # –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–µ–∫—Ü–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ fieldHelpers.ts            # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îú‚îÄ‚îÄ types.ts                       # TypeScript —Ç–∏–ø—ã
‚îî‚îÄ‚îÄ README.md                      # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ API
```

### –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

```typescript
// –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
table entity_definition {
  id: string
  name: string
  table_name: string
  title_section_0: string?  // –ù–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è —Å–µ–∫—Ü–∏–∏ 0
  title_section_1: string?  // –ù–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è —Å–µ–∫—Ü–∏–∏ 1
  title_section_2: string?  // –ù–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è —Å–µ–∫—Ü–∏–∏ 2
  title_section_3: string?  // –ù–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è —Å–µ–∫—Ü–∏–∏ 3
  // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
}

table field {
  id: string
  entity_definition_id: string
  name: string
  type: string              // text, number, boolean, date, select, etc.
  db_type: string
  label: string
  section_index: number     // 0-3, –Ω–æ–º–µ—Ä —Å–µ–∫—Ü–∏–∏
  for_create_page: boolean
  for_edit_page: boolean
  required: boolean
  foreign_key: string?      // –ò–º—è –ø–æ–ª—è, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –∑–∞–≤–∏—Å–∏—Ç –≤–∏–¥–∏–º–æ—Å—Ç—å
  foreign_key_value: string? // –ó–Ω–∞—á–µ–Ω–∏–µ(—è) –¥–ª—è –ø–æ–∫–∞–∑–∞: "value1|value2" –∏–ª–∏ "any"
  // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
}
```

---

## –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```
Page Component
    ‚Üì
[Fetch EntityDefinition + Fields from DB]
    ‚Üì
Transform to TypeScript types
    ‚Üì
Pass to EntityFormWithSections
```

### 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º—ã

```
EntityFormWithSections
    ‚Üì
Filter relevant fields (forCreatePage / forEditPage)
    ‚Üì
createFormStructure()
    ‚îú‚îÄ Group fields by section_index
    ‚îú‚îÄ Sort by display_index
    ‚îî‚îÄ Create FormSection[] with titles
    ‚Üì
createSchema()
    ‚îú‚îÄ Build Yup validation schema
    ‚îú‚îÄ Apply required rules
    ‚îî‚îÄ Apply conditional validation
    ‚Üì
getItemForEdit()
    ‚îú‚îÄ Normalize server data
    ‚îú‚îÄ Apply default values
    ‚îî‚îÄ Return initial form data
    ‚Üì
useForm() initialization
```

### 3. –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ñ–æ—Ä–º—ã

```
FormWithSections
    ‚Üì
watch() - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤—Å–µ—Ö –ø–æ–ª–µ–π
    ‚Üì
filterVisibleSections()
    ‚îú‚îÄ –î–ª—è –∫–∞–∂–¥–æ–π —Å–µ–∫—Ü–∏–∏
    ‚îÇ   ‚îî‚îÄ –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—è
    ‚îÇ       ‚îî‚îÄ isFieldVisible()
    ‚îÇ           ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ foreignKey
    ‚îÇ           ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ foreignKeyValue
    ‚îÇ           ‚îî‚îÄ Return true/false
    ‚îî‚îÄ Filter empty sections
    ‚Üì
Render sections
    ‚îî‚îÄ –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–∏–º–æ–≥–æ –ø–æ–ª—è
        ‚îî‚îÄ GetInputForField()
            ‚îî‚îÄ Switch –ø–æ field.type
                ‚îú‚îÄ text/textarea ‚Üí InputText
                ‚îú‚îÄ number ‚Üí InputNumber
                ‚îú‚îÄ boolean ‚Üí InputSwitch
                ‚îú‚îÄ date ‚Üí InputDate
                ‚îú‚îÄ select/multipleSelect ‚Üí InputSelect
                ‚îî‚îÄ relation ‚Üí InputRelation
```

### 4. –í–∞–ª–∏–¥–∞—Ü–∏—è

```
User Input Change
    ‚Üì
react-hook-form Controller
    ‚Üì
Yup Schema Validation
    ‚îú‚îÄ Type validation
    ‚îú‚îÄ Required validation
    ‚îî‚îÄ Conditional validation (when)
    ‚Üì
Error state update
    ‚Üì
Display error message
```

### 5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ

```
User clicks Submit
    ‚Üì
handleSubmit()
    ‚Üì
Validate all fields
    ‚Üì
onSubmit(formData)
    ‚Üì
EntityFormWithSections.handleSubmit
    ‚Üì
createOrUpdateEntityInstance()
    ‚îú‚îÄ Prepare payload
    ‚îú‚îÄ Call API/Service
    ‚îî‚îÄ Handle response
    ‚Üì
Redirect or show error
```

---

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 1. FormWithSections (–≥–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç)

**–§–∞–π–ª**: `lib/form-generation/components/FormWithSections.tsx`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û—Ä–∫–µ—Å—Ç—Ä–∏—Ä—É–µ—Ç –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–æ—Ä–º–æ–π.

**–ö–ª—é—á–µ–≤–∞—è –ª–æ–≥–∏–∫–∞**:

```typescript
export function FormWithSections({
  entityDefinition,
  fields,
  mode,
  initialData,
  onSubmit,
  onCancel,
}) {
  // 1. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –ø–æ–ª–µ–π
  const relevantFields = useMemo(() => {
    return fields.filter((f) =>
      mode === "create" ? f.forCreatePage : f.forEditPage
    );
  }, [fields, mode]);

  // 2. –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–µ–∫—Ü–∏–π
  const formStructure = useMemo(() => {
    return createFormStructure(entityDefinition, relevantFields, mode);
  }, [entityDefinition, relevantFields, mode]);

  // 3. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  const preparedInitialData = useMemo(() => {
    return getItemForEdit(relevantFields, initialData);
  }, [relevantFields, initialData]);

  // 4. –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
  const validationSchema = useMemo(() => {
    return createSchema(relevantFields);
  }, [relevantFields]);

  // 5. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è react-hook-form
  const methods = useForm<FormData>({
    mode: "onTouched",
    resolver: yupResolver(validationSchema),
    defaultValues: preparedInitialData,
  });

  // 6. –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏
  const formValues = watch();

  // 7. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–∏–º—ã—Ö —Å–µ–∫—Ü–∏–π
  const visibleSections = useMemo(() => {
    return filterVisibleSections(formStructure, formValues);
  }, [formStructure, formValues]);

  // 8. –†–µ–Ω–¥–µ—Ä–∏–Ω–≥
  return (
    <FormProvider {...methods}>
      <form onSubmit={handleSubmit(onSubmitHandler)}>
        {visibleSections.map((section) => (
          <Card key={section.sectionIndex}>
            <CardHeader>
              <CardTitle>{section.title}</CardTitle>
            </CardHeader>
            <CardContent>
              {section.fields.map((field) => (
                <GetInputForField
                  key={field.id}
                  field={field}
                  control={control}
                  disabled={isPending}
                />
              ))}
            </CardContent>
          </Card>
        ))}
      </form>
    </FormProvider>
  );
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `useMemo` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- `FormProvider` –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ react-hook-form
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π

#### 2. createFormStructure (—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ–∫—Ü–∏–π)

**–§–∞–π–ª**: `lib/form-generation/utils/createFormStructure.ts`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç –ø–æ–ª—è –ø–æ —Å–µ–∫—Ü–∏—è–º –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏—è.

**–ê–ª–≥–æ—Ä–∏—Ç–º**:

```typescript
export function createFormStructure(
  entityDefinition: EntityDefinition,
  fields: Field[],
  mode: "create" | "edit"
): FormStructure {
  // 1. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª–µ–π –ø–æ —Ä–µ–∂–∏–º—É
  const relevantFields = fields.filter((field) =>
    mode === "create" ? field.forCreatePage : field.forEditPage
  );

  // 2. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ displayIndex
  const sortedFields = [...relevantFields].sort(
    (a, b) => (a.displayIndex ?? 0) - (b.displayIndex ?? 0)
  );

  // 3. –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ sectionIndex
  const fieldsBySectionIndex: Record<number, Field[]> = {};
  sortedFields.forEach((field) => {
    const sectionIdx = field.sectionIndex ?? 0;
    if (!fieldsBySectionIndex[sectionIdx]) {
      fieldsBySectionIndex[sectionIdx] = [];
    }
    fieldsBySectionIndex[sectionIdx].push(field);
  });

  // 4. –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ–∫—Ü–∏–π —Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏
  const sections: FormSection[] = Object.entries(fieldsBySectionIndex)
    .map(([sectionIndexStr, sectionFields]) => {
      const sectionIndex = Number(sectionIndexStr);

      // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Å–µ–∫—Ü–∏–∏
      let title = "General Information"; // default –¥–ª—è —Å–µ–∫—Ü–∏–∏ 0
      if (sectionIndex === 0 && entityDefinition.titleSection0) {
        title = entityDefinition.titleSection0;
      } else if (sectionIndex === 1) {
        title = entityDefinition.titleSection1 || "Section 1";
      } else if (sectionIndex === 2) {
        title = entityDefinition.titleSection2 || "Section 2";
      } else if (sectionIndex === 3) {
        title = entityDefinition.titleSection3 || "Section 3";
      }

      return {
        sectionIndex,
        title,
        fields: sectionFields,
      };
    })
    .sort((a, b) => a.sectionIndex - b.sectionIndex);

  return {
    entityDefinition,
    sections,
    allFields: sortedFields,
  };
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:

```typescript
{
  entityDefinition: EntityDefinition,
  sections: [
    {
      sectionIndex: 0,
      title: "–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",
      fields: [Field, Field, ...]
    },
    {
      sectionIndex: 1,
      title: "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ",
      fields: [Field, Field, ...]
    }
  ],
  allFields: [Field, Field, ...]
}
```

#### 3. filterVisibleSections (—É—Å–ª–æ–≤–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å)

**–§–∞–π–ª**: `lib/form-generation/utils/createFormStructure.ts`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –§–∏–ª—å—Ç—Ä—É–µ—Ç —Å–µ–∫—Ü–∏–∏ –∏ –ø–æ–ª—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —É—Å–ª–æ–≤–∏–π –≤–∏–¥–∏–º–æ—Å—Ç–∏.

**–ê–ª–≥–æ—Ä–∏—Ç–º**:

```typescript
export function filterVisibleSections(
  formStructure: FormStructure,
  formData: Record<string, unknown>
): FormSection[] {
  return (
    formStructure.sections
      .map((section) => {
        // –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ–ª—è –≤ —Å–µ–∫—Ü–∏–∏
        const visibleFields = section.fields.filter((field) =>
          isFieldVisible(field, formData)
        );

        return {
          ...section,
          fields: visibleFields,
        };
      })
      // –£–±–∏—Ä–∞–µ–º –ø—É—Å—Ç—ã–µ —Å–µ–∫—Ü–∏–∏
      .filter((section) => section.fields.length > 0)
  );
}

function isFieldVisible(
  field: Field,
  formData: Record<string, unknown>
): boolean {
  // –ï—Å–ª–∏ –Ω–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π - –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º–æ
  if (!field.foreignKey || !field.foreignKeyValue) {
    return true;
  }

  // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø–æ–ª—è
  const parentValue = formData[field.foreignKey];

  // –ï—Å–ª–∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ - —Å–∫—Ä—ã–≤–∞–µ–º
  if (parentValue == null) {
    return false;
  }

  const parentValueStr = String(parentValue);

  // –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ "any" - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ—Å–ª–∏ –µ—Å—Ç—å –ª—é–±–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
  if (field.foreignKeyValue === "any") {
    return Boolean(parentValueStr) && parentValueStr !== "none";
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (pipe-separated)
  const allowedValues = field.foreignKeyValue.split("|");
  return allowedValues.includes(parentValueStr);
}
```

**–ü—Ä–∏–º–µ—Ä—ã —É—Å–ª–æ–≤–∏–π**:

```typescript
// –ü—Ä–∏–º–µ—Ä 1: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –µ—Å–ª–∏ parentField === "yes"
{
  foreignKey: "parentField",
  foreignKeyValue: "yes"
}

// –ü—Ä–∏–º–µ—Ä 2: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –µ—Å–ª–∏ parentField === "option1" –ò–õ–ò "option2"
{
  foreignKey: "parentField",
  foreignKeyValue: "option1|option2"
}

// –ü—Ä–∏–º–µ—Ä 3: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –µ—Å–ª–∏ parentField –∏–º–µ–µ—Ç –ª—é–±–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–∫—Ä–æ–º–µ null/none)
{
  foreignKey: "parentField",
  foreignKeyValue: "any"
}
```

#### 4. createSchema (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏)

**–§–∞–π–ª**: `lib/form-generation/utils/createSchema.ts`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–µ—Ç Yup —Å—Ö–µ–º—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–µ–π.

**–ê–ª–≥–æ—Ä–∏—Ç–º**:

```typescript
export function createSchema(fields: Field[]): Yup.ObjectSchema<any> {
  const shape = fields.reduce<Record<string, Yup.AnySchema>>(
    (schema, field) => {
      // 1. –ü–æ–ª—É—á–∞–µ–º –±–∞–∑–æ–≤—ã–π –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –¥–ª—è —Ç–∏–ø–∞
      let validator = getValidatorForType(field);

      // 2. –ü—Ä–∏–º–µ–Ω—è–µ–º required –≤–∞–ª–∏–¥–∞—Ü–∏—é
      if (field.required) {
        const message = field.requiredText || "This field is required";

        // –ï—Å–ª–∏ –ø–æ–ª–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥—Ä—É–≥–æ–≥–æ - —É—Å–ª–æ–≤–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
        if (field.foreignKey && field.foreignKeyValue) {
          validator = applyConditionalValidation(validator, field, message);
        } else {
          // –ë–µ–∑—É—Å–ª–æ–≤–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
          validator = applyRequiredValidation(validator, field, message);
        }
      }

      schema[field.name] = validator;
      return schema;
    },
    {}
  );

  return Yup.object().shape(shape);
}
```

**–¢–∏–ø—ã –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤**:

```typescript
function getValidatorForType(field: Field): Yup.AnySchema {
  switch (field.type) {
    case "text":
    case "textarea":
      return Yup.string().nullable();

    case "number":
      return Yup.number()
        .nullable()
        .transform((v, o) => (o === "" ? null : v));

    case "boolean":
      return Yup.boolean().nullable();

    case "date":
      return Yup.date().nullable();

    case "select":
      return Yup.string().nullable();

    case "multipleSelect":
      return Yup.array().of(Yup.string()).nullable();

    case "relation":
      return Yup.array().of(Yup.string()).nullable();

    default:
      return Yup.mixed().nullable();
  }
}
```

**–£—Å–ª–æ–≤–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è**:

```typescript
function applyConditionalValidation(
  validator: Yup.AnySchema,
  field: Field,
  message: string
): Yup.AnySchema {
  return validator.when(field.foreignKey!, {
    is: (value: any) => {
      if (!value) return false;
      const valueStr = String(value);

      if (field.foreignKeyValue === "any") {
        return Boolean(valueStr) && valueStr !== "none";
      }

      const allowedValues = field.foreignKeyValue!.split("|");
      return allowedValues.includes(valueStr);
    },
    then: (schema) => applyRequiredValidation(schema, field, message),
    otherwise: (schema) => schema.nullable(),
  });
}
```

#### 5. getItemForEdit (–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö)

**–§–∞–π–ª**: `lib/form-generation/utils/getItemForEdit.ts`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ–æ—Ä–º—ã.

**–ê–ª–≥–æ—Ä–∏—Ç–º**:

```typescript
export function getItemForEdit(
  fields: Field[],
  serverData?: Record<string, any>
): Record<string, any> {
  const formData: Record<string, any> = {};

  fields.forEach((field) => {
    const serverValue = serverData?.[field.name];

    // –ï—Å–ª–∏ –µ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–∞ - –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –µ–≥–æ
    if (serverValue !== null && serverValue !== undefined) {
      formData[field.name] = normalizeValueForField(serverValue, field);
    } else {
      // –ò–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º default –∑–Ω–∞—á–µ–Ω–∏–µ
      formData[field.name] = getDefaultValueForField(field);
    }
  });

  return formData;
}
```

**–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π**:

```typescript
function normalizeValueForField(value: any, field: Field): any {
  switch (field.type) {
    case "number":
      return typeof value === "number" ? value : parseFloat(value) || null;

    case "boolean":
      return Boolean(value);

    case "date":
      if (value instanceof Date) return value;
      if (typeof value === "string") return new Date(value);
      return null;

    case "multipleSelect":
    case "relation":
      return Array.isArray(value) ? value : [];

    default:
      return value;
  }
}
```

**–ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**:

```typescript
function getDefaultValueForField(field: Field): any {
  // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º explicit defaults –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
  if (
    field.defaultStringValue !== undefined &&
    field.defaultStringValue !== null
  ) {
    return field.defaultStringValue;
  }
  if (
    field.defaultNumberValue !== undefined &&
    field.defaultNumberValue !== null
  ) {
    return field.defaultNumberValue;
  }
  if (
    field.defaultBooleanValue !== undefined &&
    field.defaultBooleanValue !== null
  ) {
    return field.defaultBooleanValue;
  }
  if (field.defaultDateValue !== undefined && field.defaultDateValue !== null) {
    return new Date(field.defaultDateValue);
  }

  // –ó–∞—Ç–µ–º type-based defaults
  switch (field.type) {
    case "boolean":
      return false;
    case "multipleSelect":
    case "relation":
      return [];
    default:
      return null;
  }
}
```

#### 6. Input –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**–û–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**:

```typescript
interface InputProps {
  field: Field; // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—è
  control: Control<FormData>; // react-hook-form –∫–æ–Ω—Ç—Ä–æ–ª
  disabled?: boolean; // –°–æ—Å—Ç–æ—è–Ω–∏–µ disabled
  options?: SelectOption[]; // –û–ø—Ü–∏–∏ –¥–ª—è select (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
}

export function InputText({ field, control, disabled }: InputProps) {
  return (
    <Controller
      name={field.name}
      control={control}
      render={({ field: formField, fieldState: { error } }) => {
        // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏—è
        const stringValue =
          typeof formField.value === "string" ? formField.value : "";

        return (
          <div>
            <Label htmlFor={field.name}>
              {field.label}
              {field.required && <span className="text-red-500">*</span>}
            </Label>

            <Input
              id={field.name}
              value={stringValue}
              onChange={formField.onChange}
              onBlur={formField.onBlur}
              disabled={disabled}
              placeholder={field.placeholder || ""}
            />

            {error && <p className="text-sm text-red-500">{error.message}</p>}

            {field.description && (
              <p className="text-sm text-muted-foreground">
                {field.description}
              </p>
            )}
          </div>
        );
      }}
    />
  );
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ InputRelation**:

```typescript
export function InputRelation({ field, control, disabled }: InputProps) {
  const relatedEntityId = field.relatedEntityDefinitionId;

  if (!relatedEntityId) {
    return <p className="text-red-500">Error: Missing related entity</p>;
  }

  return (
    <Controller
      name={field.name}
      control={control}
      render={({ field: formField, fieldState: { error } }) => {
        // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫ –º–∞—Å—Å–∏–≤—É —Å—Ç—Ä–æ–∫
        const rawValue = formField.value;
        const valueAsArray: string[] = Array.isArray(rawValue)
          ? rawValue.filter((v): v is string => typeof v === "string")
          : typeof rawValue === "string"
          ? [rawValue]
          : [];

        return (
          <div>
            <Label htmlFor={field.name}>
              {field.label}
              {field.required && <span className="text-red-500">*</span>}
            </Label>

            {/* RelationSelect –∑–∞–≥—Ä—É–∂–∞–µ—Ç –æ–ø—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ */}
            <RelationSelect
              relatedEntityDefinitionId={relatedEntityId}
              value={valueAsArray}
              onChange={formField.onChange}
              onBlur={formField.onBlur}
              disabled={disabled}
              label={field.label}
              required={field.required}
            />

            {error && <p className="text-sm text-red-500">{error.message}</p>}
          </div>
        );
      }}
    />
  );
}
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏

#### –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∏—è

**–§–∞–π–ª**: `app/[projectId]/entities/[entityDefinitionId]/new/page.tsx`

```typescript
export default async function NewEntityPage({ params }) {
  const { projectId, entityDefinitionId } = params;

  // 1. –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
  const entityDefinition = await getEntityDefinition(entityDefinitionId);
  const fields = await getFields(entityDefinitionId);

  // 2. –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ñ–æ—Ä–º—ã
  return (
    <EntityFormWithSections
      entityDefinition={entityDefinition}
      fields={fields}
      mode="create"
    />
  );
}
```

#### –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–§–∞–π–ª**: `app/[projectId]/entities/[entityDefinitionId]/[instanceId]/edit/page.tsx`

```typescript
export default async function EditEntityPage({ params }) {
  const { projectId, entityDefinitionId, instanceId } = params;

  // 1. –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
  const entityDefinition = await getEntityDefinition(entityDefinitionId);
  const fields = await getFields(entityDefinitionId);

  // 2. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–∞
  const instance = await getEntityInstance(
    entityDefinition.tableName,
    instanceId
  );

  // 3. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ñ–æ—Ä–º—ã
  const formData = prepareFormData(instance, fields);

  // 4. –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ñ–æ—Ä–º—ã
  return (
    <EntityFormWithSections
      entityDefinition={entityDefinition}
      fields={fields}
      mode="edit"
      initialData={formData}
      instanceId={instanceId}
    />
  );
}
```

#### Wrapper –∫–æ–º–ø–æ–Ω–µ–Ω—Ç EntityFormWithSections

**–§–∞–π–ª**: `app/[projectId]/entities/[entityDefinitionId]/EntityFormWithSections.tsx`

```typescript
"use client";

export function EntityFormWithSections({
  entityDefinition,
  fields,
  mode,
  initialData,
  instanceId,
}: Props) {
  const router = useRouter();
  const projectId = useParams().projectId as string;

  const handleSubmit = async (formData: FormData) => {
    try {
      if (mode === "create") {
        await createEntityInstance(entityDefinition.tableName, formData);
      } else {
        await updateEntityInstance(
          entityDefinition.tableName,
          instanceId!,
          formData
        );
      }

      router.push(`/${projectId}/entities/${entityDefinition.id}`);
      router.refresh();
    } catch (error) {
      console.error("Error saving entity:", error);
      throw error;
    }
  };

  const handleCancel = () => {
    router.back();
  };

  return (
    <FormWithSections
      entityDefinition={entityDefinition}
      fields={fields}
      mode={mode}
      initialData={initialData}
      onSubmit={handleSubmit}
      onCancel={handleCancel}
      submitButtonText={mode === "create" ? "Create" : "Save"}
      cancelButtonText="Cancel"
    />
  );
}
```

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–∞—è —Ñ–æ—Ä–º–∞ –±–µ–∑ —Å–µ–∫—Ü–∏–π

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**:

```typescript
// EntityDefinition
{
  name: "User",
  tableName: "users",
  // titleSection0, titleSection1, etc. –Ω–µ –∑–∞–¥–∞–Ω—ã
}

// Fields
[
  { name: "name", type: "text", label: "Name", sectionIndex: 0, required: true },
  { name: "email", type: "text", label: "Email", sectionIndex: 0, required: true },
  { name: "age", type: "number", label: "Age", sectionIndex: 0 },
]
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:

- –û–¥–Ω–∞ —Å–µ–∫—Ü–∏—è —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "General Information"
- –¢—Ä–∏ –ø–æ–ª—è: Name, Email, Age

### –ü—Ä–∏–º–µ—Ä 2: –§–æ—Ä–º–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–µ–∫—Ü–∏—è–º–∏

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**:

```typescript
// EntityDefinition
{
  name: "Product",
  tableName: "products",
  titleSection0: "Basic Information",
  titleSection1: "Pricing",
  titleSection2: "Inventory",
}

// Fields
[
  { name: "name", type: "text", label: "Product Name", sectionIndex: 0, required: true },
  { name: "description", type: "textarea", label: "Description", sectionIndex: 0 },
  { name: "price", type: "number", label: "Price", sectionIndex: 1, required: true },
  { name: "discount", type: "number", label: "Discount %", sectionIndex: 1 },
  { name: "stock", type: "number", label: "Stock", sectionIndex: 2, required: true },
  { name: "warehouse", type: "text", label: "Warehouse", sectionIndex: 2 },
]
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:

- –°–µ–∫—Ü–∏—è "Basic Information": name, description
- –°–µ–∫—Ü–∏—è "Pricing": price, discount
- –°–µ–∫—Ü–∏—è "Inventory": stock, warehouse

### –ü—Ä–∏–º–µ—Ä 3: –£—Å–ª–æ–≤–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å –ø–æ–ª–µ–π

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**:

```typescript
// Fields
[
  {
    name: "type",
    type: "select",
    label: "Type",
    sectionIndex: 0,
    required: true,
    options: ["individual", "company"],
  },
  {
    name: "firstName",
    type: "text",
    label: "First Name",
    sectionIndex: 0,
    required: true,
    foreignKey: "type",
    foreignKeyValue: "individual", // –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ type === "individual"
  },
  {
    name: "lastName",
    type: "text",
    label: "Last Name",
    sectionIndex: 0,
    required: true,
    foreignKey: "type",
    foreignKeyValue: "individual",
  },
  {
    name: "companyName",
    type: "text",
    label: "Company Name",
    sectionIndex: 0,
    required: true,
    foreignKey: "type",
    foreignKeyValue: "company", // –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ type === "company"
  },
];
```

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ**:

- –ü—Ä–∏ –≤—ã–±–æ—Ä–µ type = "individual": –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è firstName –∏ lastName
- –ü—Ä–∏ –≤—ã–±–æ—Ä–µ type = "company": –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è companyName
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫ –≤–∏–¥–∏–º—ã–º –ø–æ–ª—è–º

### –ü—Ä–∏–º–µ—Ä 4: Relation –ø–æ–ª—è

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**:

```typescript
// Fields
[
  {
    name: "title",
    type: "text",
    label: "Article Title",
    sectionIndex: 0,
    required: true,
  },
  {
    name: "author_id",
    type: "relation",
    label: "Author",
    sectionIndex: 0,
    required: true,
    relatedEntityDefinitionId: "uuid-of-user-entity", // –°–≤—è–∑—å —Å User
  },
  {
    name: "category_ids",
    type: "relation",
    label: "Categories",
    sectionIndex: 0,
    required: false,
    relatedEntityDefinitionId: "uuid-of-category-entity", // –°–≤—è–∑—å —Å Category
  },
];
```

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ**:

- `author_id`: RelationSelect –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∏—Ö –≤ dropdown
- `category_ids`: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –æ–ø—Ü–∏–π –∏–∑ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü

### –ü—Ä–∏–º–µ—Ä 5: –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–ª–æ–∂–Ω–∞—è —Ñ–æ—Ä–º–∞

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**:

```typescript
// EntityDefinition
{
  name: "Order",
  tableName: "orders",
  titleSection0: "Customer Information",
  titleSection1: "Order Details",
  titleSection2: "Delivery",
}

// Fields
[
  // –°–µ–∫—Ü–∏—è 0: Customer Information
  {
    name: "customer_type",
    type: "select",
    label: "Customer Type",
    sectionIndex: 0,
    required: true,
    options: ["existing", "new"]
  },
  {
    name: "customer_id",
    type: "relation",
    label: "Select Customer",
    sectionIndex: 0,
    required: true,
    foreignKey: "customer_type",
    foreignKeyValue: "existing",
    relatedEntityDefinitionId: "uuid-of-customer-entity"
  },
  {
    name: "customer_name",
    type: "text",
    label: "Customer Name",
    sectionIndex: 0,
    required: true,
    foreignKey: "customer_type",
    foreignKeyValue: "new"
  },

  // –°–µ–∫—Ü–∏—è 1: Order Details
  {
    name: "product_ids",
    type: "relation",
    label: "Products",
    sectionIndex: 1,
    required: true,
    relatedEntityDefinitionId: "uuid-of-product-entity"
  },
  {
    name: "total_amount",
    type: "number",
    label: "Total Amount",
    sectionIndex: 1,
    required: true
  },

  // –°–µ–∫—Ü–∏—è 2: Delivery
  {
    name: "requires_delivery",
    type: "boolean",
    label: "Requires Delivery",
    sectionIndex: 2
  },
  {
    name: "delivery_address",
    type: "textarea",
    label: "Delivery Address",
    sectionIndex: 2,
    required: true,
    foreignKey: "requires_delivery",
    foreignKeyValue: "any"  // –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Å—Ç–∞–≤–∫–∞
  },
  {
    name: "delivery_date",
    type: "date",
    label: "Delivery Date",
    sectionIndex: 2,
    foreignKey: "requires_delivery",
    foreignKeyValue: "any"
  },
]
```

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ**:

1. **–°–µ–∫—Ü–∏—è "Customer Information"**:

   - –í—ã–±–æ—Ä —Ç–∏–ø–∞ –∫–ª–∏–µ–Ω—Ç–∞ (existing/new)
   - –ï—Å–ª–∏ "existing" - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è relation select –¥–ª—è –≤—ã–±–æ—Ä–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
   - –ï—Å–ª–∏ "new" - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏

2. **–°–µ–∫—Ü–∏—è "Order Details"**:

   - –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä –ø—Ä–æ–¥—É–∫—Ç–æ–≤
   - –í–≤–æ–¥ —Å—É–º–º—ã –∑–∞–∫–∞–∑–∞
   - –í—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º—ã

3. **–°–µ–∫—Ü–∏—è "Delivery"**:
   - Checkbox "Requires Delivery"
   - –ï—Å–ª–∏ –æ—Ç–º–µ—á–µ–Ω - –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∞–¥—Ä–µ—Å –∏ –¥–∞—Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ —Å–µ–∫—Ü–∏—è –≤–∏–¥–∏–º–∞

---

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –ì–∏–±–∫–æ—Å—Ç—å

- –õ—é–±–∞—è —Å—É—â–Ω–æ—Å—Ç—å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ñ–æ—Ä–º—É –±–µ–∑ –Ω–∞–ø–∏—Å–∞–Ω–∏—è –∫–æ–¥–∞
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è —á–µ—Ä–µ–∑ UI

### 2. –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

- –û–¥–∏–Ω –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
- –õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å –Ω–æ–≤—ã–º–∏ —Ç–∏–ø–∞–º–∏ –ø–æ–ª–µ–π

### 3. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å

- –í—Å—è –ª–æ–≥–∏–∫–∞ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ `lib/form-generation/`
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

### 4. –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ TypeScript
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–≤–æ–¥ —Ç–∏–ø–æ–≤

### 5. UX

- –°–µ–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É–ª—É—á—à–∞–µ—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å
- –£—Å–ª–æ–≤–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å —É–ø—Ä–æ—â–∞–µ—Ç —Ñ–æ—Ä–º—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏

### 6. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- `useMemo` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ—Å—á–µ—Ç–æ–≤
- –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –æ–ø—Ü–∏–π –¥–ª—è relation –ø–æ–ª–µ–π
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏

---

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –±—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–ú–∞–∫—Å–∏–º—É–º 4 —Å–µ–∫—Ü–∏–∏** (0-3)

   - –ú–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

2. **–û–¥–Ω–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å** (A ‚Üí B)

   - –ü–æ–∫–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è A ‚Üí B ‚Üí C
   - –ú–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É

3. **–ù–µ—Ç –æ–±—Ä–∞—Ç–Ω—ã—Ö relation –ø–æ–ª–µ–π**

   - –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ relation –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ–µ –ø–æ–ª–µ
   - –û—Ç–ª–æ–∂–µ–Ω–æ –¥–ª—è –±—É–¥—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

4. **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø—Ü–∏–∏ –¥–ª—è select**
   - Options –ø–æ–∫–∞ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ JSON, –∞ –Ω–µ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ
   - –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é –∑–∞–≥—Ä—É–∑–∫—É

### –ü–ª–∞–Ω—ã –Ω–∞ –±—É–¥—É—â–µ–µ

1. **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**

   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ A ‚Üí B ‚Üí C ‚Üí D

2. **–í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã**

   - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π inline

3. **–ö–∞—Å—Ç–æ–º–Ω—ã–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã**

   - Regex, min/max –¥–ª—è —Å—Ç—Ä–æ–∫, custom —Ñ—É–Ω–∫—Ü–∏–∏

4. **Drag-and-drop —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞**

   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –ø–æ–ª–µ–π —á–µ—Ä–µ–∑ UI

5. **–£—Å–ª–æ–≤–Ω—ã–µ —Å–µ–∫—Ü–∏–∏**

   - –ü–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ —Ü–µ–ª—ã—Ö —Å–µ–∫—Ü–∏–π

6. **Layout –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**

   - Horizontal/vertical layout
   - Grid columns (1, 2, 3 –∫–æ–ª–æ–Ω–∫–∏)

7. **–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ**

   - Draft mode —Å –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º

8. **–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π**
   - Audit log –¥–ª—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–æ—Ä–º –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

‚úÖ **–ï–¥–∏–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º** –¥–ª—è –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π  
‚úÖ **–ì–∏–±–∫—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é** —á–µ—Ä–µ–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ  
‚úÖ **–£—Å–ª–æ–≤–Ω—É—é –ª–æ–≥–∏–∫—É** –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ñ–æ—Ä–º  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é** –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∞–≤–∏–ª  
‚úÖ **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö  
‚úÖ **–•–æ—Ä–æ—à—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** —á–µ—Ä–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é  
‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç—É —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è** —á–µ—Ä–µ–∑ –º–æ–¥—É–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ —è–≤–ª—è–µ—Ç—Å—è —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–æ–º –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Å–ª–æ–∂–Ω—ã—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–∏—Å–∞—Ç—å —Ñ–æ—Ä–º—ã –≤—Ä—É—á–Ω—É—é –¥–ª—è –∫–∞–∂–¥–æ–π —Å—É—â–Ω–æ—Å—Ç–∏.
