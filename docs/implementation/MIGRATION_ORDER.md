# –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π

## ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫:

1. **–°–Ω–∞—á–∞–ª–∞:** `SUPABASE_MIGRATION.sql`
   - –°–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É `profiles`
   - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –±–∞–∑–æ–≤—ã–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏
   - –°–æ–∑–¥–∞–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π

2. **–ü–æ—Ç–æ–º:** `SUPABASE_ROLES_MIGRATION.sql`
   - –°–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—ã `admin_roles` –∏ `admins`
   - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç RLS –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
   - –°–æ–∑–¥–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–æ–ª—è–º–∏
   - **–ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∞–±–ª–∏—Ü—ã `profiles`** (—Ö–æ—Ç—è –Ω–∞–ø—Ä—è–º—É—é –Ω–µ —Å—Å—ã–ª–∞–µ—Ç—Å—è, –Ω–æ –ª–æ–≥–∏—á–µ—Å–∫–∏ —Å–≤—è–∑–∞–Ω–∞)

3. **–ó–∞—Ç–µ–º:** –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç `pnpm create-super-admin`
   - –°–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `igorchugurov@gmail.com`
   - –°–æ–∑–¥–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å
   - –î–æ–±–∞–≤–ª—è–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü—É `admins` —Å —Ä–æ–ª—å—é `superAdmin`

---

## üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### ‚ö†Ô∏è –í–∞–∂–Ω–æ: –†–æ–ª—å –ù–ï —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ cookies!

**–ü–æ—á–µ–º—É?**
- –†–æ–ª—å –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è (–∞–¥–º–∏–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å —É–¥–∞–ª–µ–Ω)
- –•—Ä–∞–Ω–µ–Ω–∏–µ —Ä–æ–ª–∏ –≤ cookies –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ (–º–æ–∂–Ω–æ –ø–æ–¥–¥–µ–ª–∞—Ç—å)
- –†–æ–ª—å –¥–æ–ª–∂–Ω–∞ –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞—Ç—å—Å—è –∏–∑ –ë–î –¥–ª—è –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:**
   - Supabase —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–æ–∫–µ–Ω—ã –≤ cookies (httpOnly)
   - –†–æ–ª—å –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ cookies

2. **–ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ:**
   - Middleware/Server Component –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Supabase
   - –ó–∞—Ç–µ–º –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ä–æ–ª—å –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `admins` –≤ –ë–î
   - –†–æ–ª—å –ø–æ–ª—É—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é `get_user_role(user_id)`

3. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
   - –ú–æ–∂–Ω–æ –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å —Ä–æ–ª—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–≤ –ø–∞–º—è—Ç–∏)
   - –ù–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–æ–ª–∏ –Ω—É–∂–Ω–æ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫–µ—à

---

## üìã –§–ª–æ—É —Ä–∞–±–æ—Ç—ã:

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ö–æ–¥–∏—Ç (igorchugurov@gmail.com)
   ‚Üì
2. Supabase —Å–æ–∑–¥–∞–µ—Ç —Å–µ—Å—Å–∏—é ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–∫–µ–Ω—ã –≤ cookies
   ‚Üì
3. Middleware –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
   ‚Üì
4. getServerUser() –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Supabase
   ‚Üì
5. getUserRole() –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ä–æ–ª—å –∏–∑ —Ç–∞–±–ª–∏—Ü—ã admins
   ‚Üì
6. –ï—Å–ª–∏ —Ä–æ–ª—å = 'superAdmin' –∏–ª–∏ 'admin' ‚Üí –¥–æ—Å—Ç—É–ø –∫ –¥–∞—à–±–æ—Ä–¥—É
   –ï—Å–ª–∏ —Ä–æ–ª—å = 'user' ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /welcome
   ‚Üì
7. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–æ–≥–ª–∞—Å–Ω–æ —Å–≤–æ–µ–π —Ä–æ–ª–∏
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:

- ‚úÖ –¢–æ–∫–µ–Ω—ã –≤ httpOnly cookies (–Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –∏–∑ JavaScript)
- ‚úÖ –†–æ–ª—å –ø–æ–ª—É—á–∞–µ—Ç—Å—è –∏–∑ –ë–î (–Ω–µ–ª—å–∑—è –ø–æ–¥–¥–µ–ª–∞—Ç—å)
- ‚úÖ RLS –∑–∞—â–∏—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –Ω–∞ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ (–∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å)

