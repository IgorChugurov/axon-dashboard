# –ü–ª–∞–Ω –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## üìä –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–∏—Ö –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ä–æ–ª–∏

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
–ù–∞ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –∫ –∑–∞—â–∏—â–µ–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
1. **Middleware**: `updateSession()` ‚Üí `getUser()` (1 –∑–∞–ø—Ä–æ—Å –∫ Supabase)
2. **Middleware**: `getUserRoleCached()` ‚Üí –∑–∞–ø—Ä–æ—Å –∫ –ë–î (–µ—Å–ª–∏ –Ω–µ—Ç –≤ –∫–µ—à–µ)
3. **Layout**: `getServerUser()` ‚Üí `getUser()` + `getUserRole()` (2 –∑–∞–ø—Ä–æ—Å–∞)
4. **Page** (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ): `getUser()` + `getUserRole()` (2 –∑–∞–ø—Ä–æ—Å–∞)

**–ò—Ç–æ–≥–æ: –¥–æ 5 –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –æ–¥–∏–Ω —Ä–µ–Ω–¥–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã!**

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–∏

Middleware —É–∂–µ –ø—Ä–æ–≤–µ—Ä–∏–ª —Ä–æ–ª—å –∏ —Å–¥–µ–ª–∞–ª —Ä–µ–¥–∏—Ä–µ–∫—Ç, –Ω–æ Layout –∏ Page –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Å–Ω–æ–≤–∞.

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ò–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å –≤ AuthProvider

AuthProvider –ø–æ–ª—É—á–∞–µ—Ç `initialUser` –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞, –Ω–æ –∑–∞—Ç–µ–º —Å–Ω–æ–≤–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å–µ—Å—Å–∏—é —á–µ—Ä–µ–∑ `getSession()`.

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –ù–µ—Ç –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ middleware

Middleware –ø–æ–ª—É—á–∞–µ—Ç user –∏ role, –Ω–æ –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç –∏—Ö –¥–∞–ª—å—à–µ —á–µ—Ä–µ–∑ headers, –ø–æ—ç—Ç–æ–º—É Layout/Page –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç –∏—Ö —Å–Ω–æ–≤–∞.

### –ü—Ä–æ–±–ª–µ–º–∞ 5: –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–æ–ª–µ–π

- –ö–µ—à –≤ –ø–∞–º—è—Ç–∏ (–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ–∂–¥—É –∏–Ω—Å—Ç–∞–Ω—Å–∞–º–∏ —Å–µ—Ä–≤–µ—Ä–∞)
- TTL 5 –º–∏–Ω—É—Ç (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ)
- –ù–µ—Ç –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–æ–ª–∏

### –ü—Ä–æ–±–ª–µ–º–∞ 6: –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ router.refresh()

`onAuthStateChange` –≤—ã–∑—ã–≤–∞–µ—Ç `router.refresh()` –ø—Ä–∏ –∫–∞–∂–¥–æ–º `SIGNED_IN`, –¥–∞–∂–µ –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –Ω—É–∂–Ω–æ.

### –ü—Ä–æ–±–ª–µ–º–∞ 7: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ API routes

API routes —Å–Ω–æ–≤–∞ –≤—ã–∑—ã–≤–∞—é—Ç `getServerUser()`, —Ö–æ—Ç—è middleware —É–∂–µ –ø—Ä–æ–≤–µ—Ä–∏–ª –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é.

---

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 1: –ü–µ—Ä–µ–¥–∞—á–∞ user –∏ role –∏–∑ middleware —á–µ—Ä–µ–∑ headers

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**
- –í middleware –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å `user.id` –∏ `role` —á–µ—Ä–µ–∑ response headers
- –í Layout/Page —á–∏—Ç–∞—Ç—å –∏–∑ headers –≤–º–µ—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã
- –ë—ã—Å—Ç—Ä–µ–µ —Ä–µ–Ω–¥–µ—Ä

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

```typescript
// middleware.ts
const userRole = await getUserRoleCached(user.id);
response.headers.set("x-user-id", user.id);
response.headers.set("x-user-role", userRole);
response.headers.set("x-user-email", user.email || "");
```

```typescript
// lib/supabase/auth.ts
export async function getServerUserFromHeaders(): Promise<User | null> {
  const headersList = await headers();
  const userId = headersList.get("x-user-id");
  const userRole = headersList.get("x-user-role");
  const userEmail = headersList.get("x-user-email");
  
  if (!userId) return null;
  
  return {
    id: userId,
    email: userEmail || "",
    role: userRole as UserRole || "user",
  };
}
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 2: –£–ø—Ä–æ—â–µ–Ω–∏–µ AuthProvider

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `initialUser` –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö
- `getSession()` –≤—ã–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏, –Ω–µ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

```typescript
// components/providers/AuthProvider.tsx
useEffect(() => {
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º initialUser –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫
  if (initialUser) {
    setAuthState({
      user: initialUser,
      isAuthenticated: true,
      isLoading: false,
    });
  } else {
    // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç initialUser, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Å—Å–∏—é
    supabase.auth.getSession().then(({ data: { session } }) => {
      const user = transformSupabaseUser(session?.user ?? null);
      setAuthState({
        user,
        isAuthenticated: !!user,
        isLoading: false,
      });
    });
  }
  
  // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
  const { data: { subscription } } = supabase.auth.onAuthStateChange(
    async (event, session) => {
      // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
      if (event === "SIGNED_IN" || event === "SIGNED_OUT" || event === "TOKEN_REFRESHED") {
        const user = transformSupabaseUser(session?.user ?? null);
        setAuthState({
          user,
          isAuthenticated: !!user,
          isLoading: false,
        });
        
        if (event === "SIGNED_IN" && user) {
          router.refresh();
        }
        
        if (event === "SIGNED_OUT") {
          router.push("/login");
          router.refresh();
        }
      }
    }
  );
  
  return () => subscription.unsubscribe();
}, [initialUser, router, supabase.auth]);
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 3: –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ —Ä–æ–ª–∏

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**
- –£–±—Ä–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ä–æ–ª–∏ –∏–∑ Page, –µ—Å–ª–∏ –æ–Ω–∞ —É–∂–µ –µ—Å—Ç—å –≤ middleware
- –î–æ–≤–µ—Ä—è—Ç—å middleware –≤ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

```typescript
// app/page.tsx
// –£–ë–†–ê–¢–¨ —ç—Ç—É –ø—Ä–æ–≤–µ—Ä–∫—É - middleware —É–∂–µ —Å–¥–µ–ª–∞–ª —Ä–µ–¥–∏—Ä–µ–∫—Ç
// const userRole = await getUserRole(user.id);
// if (userRole === "user") {
//   redirect("/welcome");
// }
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 4: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–æ–ª–µ–π

**–í–∞—Ä–∏–∞–Ω—Ç A: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Next.js cache (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**

```typescript
// lib/auth/roles.ts
import { cache } from "react";

export const getUserRole = cache(async (userId: string): Promise<UserRole> => {
  // Next.js –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–µ—à–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ –≤—Ä–µ–º—è —Ä–µ–Ω–¥–µ—Ä–∞
  // –†–∞–±–æ—Ç–∞–µ—Ç –º–µ–∂–¥—É –∏–Ω—Å—Ç–∞–Ω—Å–∞–º–∏ —á–µ—Ä–µ–∑ shared cache
});
```

**–í–∞—Ä–∏–∞–Ω—Ç B: Redis –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –∫–µ—à–∞**

```typescript
// lib/auth/roles.ts
import { redis } from "@/lib/redis";

export async function getUserRoleCached(userId: string): Promise<UserRole> {
  const cacheKey = `user:role:${userId}`;
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º Redis
  const cached = await redis.get(cacheKey);
  if (cached) {
    return cached as UserRole;
  }
  
  // –ü–æ–ª—É—á–∞–µ–º –∏–∑ –ë–î
  const role = await getUserRole(userId);
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Redis –Ω–∞ 2 –º–∏–Ω—É—Ç—ã
  await redis.setex(cacheKey, 120, role);
  
  return role;
}
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 5: –£–ø—Ä–æ—â–µ–Ω–∏–µ API routes

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ middleware —á–µ—Ä–µ–∑ headers
- –ù–µ –≤—ã–∑—ã–≤–∞—Ç—å `getServerUser()` –ø–æ–≤—Ç–æ—Ä–Ω–æ

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

```typescript
// lib/api/auth.ts
export async function getAuthFromHeaders(): Promise<{
  userId: string;
  userRole: UserRole;
} | null> {
  const headersList = await headers();
  const userId = headersList.get("x-user-id");
  const userRole = headersList.get("x-user-role");
  
  if (!userId) return null;
  
  return {
    userId,
    userRole: (userRole as UserRole) || "user",
  };
}

// app/api/projects/route.ts
export async function GET(request: NextRequest) {
  const auth = await getAuthFromHeaders();
  if (!auth) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }
  
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º auth.userId –∏ auth.userRole
  // ...
}
```

---

## üìà –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- **–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤**: —Å 5 –¥–æ 1-2 –Ω–∞ —Ä–µ–Ω–¥–µ—Ä
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ —Ä–µ–Ω–¥–µ—Ä–∞**: –Ω–∞ 50-70%
- **–ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î**: –º–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ `get_user_role`

### –ö–æ–¥:
- **–£–ø—Ä–æ—â–µ–Ω–∏–µ**: –º–µ–Ω—å—à–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã**: –¥–∞–Ω–Ω—ã–µ –∏–∑ middleware
- **–õ–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å**: –º–µ–Ω—å—à–µ –º–µ—Å—Ç –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:
- **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –∫–µ—à**: —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ–∂–¥—É –∏–Ω—Å—Ç–∞–Ω—Å–∞–º–∏
- **–ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏**: –º–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Supabase –∏ –ë–î

---

## üöÄ –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –≠—Ç–∞–ø 1: –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ headers (–≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
1. –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å middleware –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ user/role —á–µ—Ä–µ–∑ headers
2. –°–æ–∑–¥–∞—Ç—å `getServerUserFromHeaders()` –≤ `lib/supabase/auth.ts`
3. –û–±–Ω–æ–≤–∏—Ç—å Layout –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è headers
4. –û–±–Ω–æ–≤–∏—Ç—å Page –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è headers

**–û—Ü–µ–Ω–∫–∞:** 2-3 —á–∞—Å–∞

### –≠—Ç–∞–ø 2: –£–ø—Ä–æ—â–µ–Ω–∏–µ AuthProvider (—Å—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `initialUser` –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫
2. –£–±—Ä–∞—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω—ã–π `getSession()` –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
3. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å `onAuthStateChange`

**–û—Ü–µ–Ω–∫–∞:** 1-2 —á–∞—Å–∞

### –≠—Ç–∞–ø 3: –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ (–Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
1. –£–±—Ä–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ä–æ–ª–∏ –∏–∑ Page
2. –£–±—Ä–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ä–æ–ª–∏ –∏–∑ Layout (–µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω–∞)

**–û—Ü–µ–Ω–∫–∞:** 30 –º–∏–Ω—É—Ç

### –≠—Ç–∞–ø 4: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è (—Å—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
1. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ Next.js cache –∏–ª–∏ Redis
2. –£–º–µ–Ω—å—à–∏—Ç—å TTL –¥–æ 1-2 –º–∏–Ω—É—Ç
3. –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—é –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–æ–ª–∏

**–û—Ü–µ–Ω–∫–∞:** 2-3 —á–∞—Å–∞ (—Å Redis), 1 —á–∞—Å (—Å Next.js cache)

### –≠—Ç–∞–ø 5: –£–ø—Ä–æ—â–µ–Ω–∏–µ API routes (–Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
1. –°–æ–∑–¥–∞—Ç—å `getAuthFromHeaders()` –¥–ª—è API routes
2. –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ API routes –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è headers

**–û—Ü–µ–Ω–∫–∞:** 1-2 —á–∞—Å–∞

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å headers:**
   - Headers `x-user-id`, `x-user-role` –¥–æ–ª–∂–Ω—ã —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –≤ middleware
   - –ù–µ –¥–æ–≤–µ—Ä—è—Ç—å —ç—Ç–∏–º headers –≤ API routes –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–º–æ–∂–Ω–æ –ø–æ–¥–¥–µ–ª–∞—Ç—å)
   - –î–ª—è API routes –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å JWT —Ç–æ–∫–µ–Ω –∏–∑ Authorization header

2. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å `getServerUser()` –¥–ª—è —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ headers –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
   - –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –Ω–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥

3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∏–Ω—Å—Ç–∞–Ω—Å–∞–º–∏ —Å–µ—Ä–≤–µ—Ä–∞
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

---

## üìù –ß–µ–∫–ª–∏—Å—Ç –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

- [ ] –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å middleware –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ headers
- [ ] –°–æ–∑–¥–∞—Ç—å `getServerUserFromHeaders()`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å Layout.tsx
- [ ] –û–±–Ω–æ–≤–∏—Ç—å Page.tsx
- [ ] –£–ø—Ä–æ—Å—Ç–∏—Ç—å AuthProvider
- [ ] –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –û–±–Ω–æ–≤–∏—Ç—å API routes
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- [ ] –ò–∑–º–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–æ/–ø–æ—Å–ª–µ

