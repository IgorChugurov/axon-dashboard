# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

**–ü—Ä–æ–µ–∫—Ç:** Admin Panel  
**–°—Ç–µ–∫:** Next.js 15.5.6 + Supabase SSR + TypeScript  
**–î–∞—Ç–∞:** 15 –Ω–æ—è–±—Ä—è 2025

## üìö –ù–∞–≤–∏–≥–∞—Ü–∏—è

### üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–ê–ö–¢–£–ê–õ–¨–ù–û–ï)

**–ù–∞—á–Ω–∏—Ç–µ –æ—Ç—Å—é–¥–∞:**

1. **[DEVELOPMENT_GUIDE.md](architecture/DEVELOPMENT_GUIDE.md)** üåü
   - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
   - –ö–∞–∫ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
   - Best practices –∏ –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞
   - **–ì–ª–∞–≤–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤**

2. **[CURRENT_AUTH_FLOW.md](architecture/CURRENT_AUTH_FLOW.md)** üîê
   - –¢–µ–∫—É—â–∏–π —Ñ–ª–æ—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å Supabase
   - –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–∫–µ–Ω—ã
   - Race conditions protection
   - Middleware –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ

3. **[HYBRID_ARCHITECTURE_GUIDE.md](implementation/HYBRID_ARCHITECTURE_GUIDE.md)** üîÑ
   - –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (SSR + Browser Client + Server Actions)
   - –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á—Ç–æ
   - –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

### üîß –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

4. **[RACE_CONDITIONS_PROTECTION.md](implementation/RACE_CONDITIONS_PROTECTION.md)** üõ°Ô∏è
   - –ó–∞—â–∏—Ç–∞ –æ—Ç race conditions
   - Server-side –∏ Client-side —Ä–µ—à–µ–Ω–∏—è
   - –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º–∞

5. **[TOKEN_REFRESH_FLOW.md](implementation/TOKEN_REFRESH_FLOW.md)** üîÑ
   - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤
   - –ü—Ä–∏–º–µ—Ä—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

6. **[ARCHITECTURE_IMPLEMENTATION_SUMMARY.md](implementation/ARCHITECTURE_IMPLEMENTATION_SUMMARY.md)** üìã
   - –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
   - –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### üìñ Guides

7. **[QUICK_START.md](guides/QUICK_START.md)** üöÄ
   - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è –Ω–æ–≤—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
   - Setup –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
   - –ü–µ—Ä–≤—ã–µ —à–∞–≥–∏

### üóÇÔ∏è –°–ø—Ä–∞–≤–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- **[SUPABASE_SETUP_GUIDE.md](implementation/SUPABASE_SETUP_GUIDE.md)** - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase
- **[ROLES_SUMMARY.md](implementation/ROLES_SUMMARY.md)** - –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π
- **[MIDDLEWARE_EXPLANATION.md](implementation/MIDDLEWARE_EXPLANATION.md)** - Middleware –¥–µ—Ç–∞–ª–∏

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
/
‚îú‚îÄ‚îÄ app/                          # Next.js App Router
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                  # –ì–ª–∞–≤–Ω–∞—è (welcome)
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx                # Root layout —Å AuthProvider
‚îÇ   ‚îú‚îÄ‚îÄ projects/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx             # Projects page (SSR)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ actions.ts           # Server Actions
‚îÇ   ‚îú‚îÄ‚îÄ api/                     # API Routes (internal)
‚îÇ   ‚îî‚îÄ‚îÄ auth/                    # Auth pages (login, callback)
‚îÇ
‚îú‚îÄ‚îÄ components/                   # React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ ProjectsList.tsx         # Client Component (Browser Client)
‚îÇ   ‚îú‚îÄ‚îÄ AppSidebar.tsx           # Sidebar –Ω–∞–≤–∏–≥–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ providers/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AuthProvider.tsx    # Auth context
‚îÇ   ‚îî‚îÄ‚îÄ ui/                      # shadcn/ui –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ
‚îú‚îÄ‚îÄ lib/                         # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ —É—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ supabase/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ server.ts           # Server Client
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ client.ts           # Browser Client
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware.ts       # Middleware + race conditions protection
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ admin.ts            # Admin Client (–æ–±—Ö–æ–¥ RLS)
‚îÇ   ‚îú‚îÄ‚îÄ projects/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ supabase.ts         # Project functions (server)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ types.ts            # Types
‚îÇ   ‚îî‚îÄ‚îÄ auth/
‚îÇ       ‚îú‚îÄ‚îÄ roles.ts            # Roles utilities
‚îÇ       ‚îî‚îÄ‚îÄ types.ts            # Auth types
‚îÇ
‚îú‚îÄ‚îÄ middleware.ts                # Next.js middleware (auth check)
‚îÇ
‚îî‚îÄ‚îÄ docs/                        # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
    ‚îú‚îÄ‚îÄ README.md               # –≠—Ç–æ—Ç —Ñ–∞–π–ª
    ‚îú‚îÄ‚îÄ architecture/           # –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
    ‚îú‚îÄ‚îÄ implementation/         # –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
    ‚îî‚îÄ‚îÄ guides/                 # –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞
```

---

## üéØ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –æ–±–∑–æ—Ä

### –°–ª–æ–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```
Browser (Client)
  ‚îú‚îÄ Client Components ('use client')
  ‚îÇ  ‚îî‚îÄ createClient() ‚Üí Browser Supabase Client
  ‚îÇ     ‚îî‚îÄ –ü—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ Supabase API
  ‚îÇ
  ‚îî‚îÄ Server Actions –≤—ã–∑–æ–≤—ã
     ‚îî‚îÄ POST –∫ Next.js —Å–µ—Ä–≤–µ—Ä—É

Next.js Server
  ‚îú‚îÄ Middleware (auth check, token refresh)
  ‚îú‚îÄ Server Components (SSR)
  ‚îÇ  ‚îî‚îÄ createClient() ‚Üí Server Supabase Client
  ‚îî‚îÄ Server Actions (–º—É—Ç–∞—Ü–∏–∏)
     ‚îî‚îÄ createClient() ‚Üí Server Supabase Client

Supabase Cloud
  ‚îú‚îÄ Authentication (—Ç–æ–∫–µ–Ω—ã, refresh)
  ‚îî‚îÄ PostgreSQL + RLS (–∑–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö)
```

### –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥

| –û–ø–µ—Ä–∞—Ü–∏—è | –ì–¥–µ | –ö–ª–∏–µ–Ω—Ç | –ü–æ—á–µ–º—É |
|----------|-----|--------|--------|
| –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ | Server Component | Server | SSR, SEO |
| –ü–∞–≥–∏–Ω–∞—Ü–∏—è | Client Component | Browser | –ë–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ |
| –ü–æ–∏—Å–∫/—Ñ–∏–ª—å—Ç—Ä—ã | Client Component | Browser | UX |
| Create/Update/Delete | Server Action | Server | –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å |

---

## üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### –§–ª–æ—É

```
1. Login ‚Üí Supabase Auth ‚Üí –¢–æ–∫–µ–Ω—ã –≤ httpOnly cookies
2. –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å ‚Üí Middleware ‚Üí updateSession() ‚Üí –û–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–∫–µ–Ω—ã
3. Server Component ‚Üí createClient() ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–∫–µ–Ω—ã
4. Browser Client ‚Üí createClient() ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ 401
```

### Race Conditions Protection

- **Server-side:** Map —Å Promise –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ (Middleware)
- **Client-side:** –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞ –≤ Supabase SDK

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –î–ª—è –Ω–æ–≤–æ–≥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:

1. **–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ:** `architecture/DEVELOPMENT_GUIDE.md`
2. **–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ:** –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (`app/projects/`)
3. **–°–æ–∑–¥–∞–π—Ç–µ:** –°–≤–æ—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ —à–∞–±–ª–æ–Ω—É
4. **–°–ª–µ–¥—É–π—Ç–µ:** Checklist –≤ –∫–æ–Ω—Ü–µ DEVELOPMENT_GUIDE.md

### –î–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:

1. **–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ:** `architecture/CURRENT_AUTH_FLOW.md`
2. **–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ:** `lib/supabase/middleware.ts`
3. **–ò–∑—É—á–∏—Ç–µ:** `implementation/RACE_CONDITIONS_PROTECTION.md`

---

## üìù Changelog

### v2.0 (15 –Ω–æ—è–±—Ä—è 2025)
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Supabase SSR
- ‚úÖ Race conditions protection —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- ‚úÖ –ì–∏–±—Ä–∏–¥–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (SSR + Browser Client + Server Actions)
- ‚úÖ Middleware –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

### v1.0 (14 –Ω–æ—è–±—Ä—è 2025)
- –ù–∞—á–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å Backend API
- –ë–∞–∑–æ–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- Projects CRUD

---

## ‚ùì FAQ

### Q: –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É?
**A:** –°–ª–µ–¥—É–π—Ç–µ —à–∞–±–ª–æ–Ω—É –≤ `DEVELOPMENT_GUIDE.md` ‚Üí "–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü"

### Q: –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Server vs Client Component?
**A:** Server –¥–ª—è SSR –∏ –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, Client –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### Q: –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤?
**A:** –ß–∏—Ç–∞–π—Ç–µ `CURRENT_AUTH_FLOW.md` ‚Üí "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤"

### Q: –ß—Ç–æ —Ç–∞–∫–æ–µ race conditions –∏ –∫–∞–∫ –º—ã –∏—Ö —Ä–µ—à–∞–µ–º?
**A:** –ß–∏—Ç–∞–π—Ç–µ `RACE_CONDITIONS_PROTECTION.md`

### Q: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ä–æ–ª—å?
**A:** –ß–∏—Ç–∞–π—Ç–µ `ROLES_SUMMARY.md`

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Next.js Documentation](https://nextjs.org/docs)
- [Supabase Documentation](https://supabase.com/docs)
- [Supabase SSR Guide](https://supabase.com/docs/guides/auth/server-side)

---

## üìß –ö–æ–Ω—Ç–∞–∫—Ç—ã

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π:
- –°–º–æ—Ç—Ä–∏—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ `/docs`
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ –≤ `/app/projects`

---

**Happy Coding! üöÄ**
