# –ü–æ–¥—Ä–æ–±–Ω—ã–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è: SQL –º–∏–≥—Ä–∞—Ü–∏—è, —Ç–æ–∫–µ–Ω—ã, RLS –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## 1. üìä SQL –º–∏–≥—Ä–∞—Ü–∏—è - —á—Ç–æ —ç—Ç–æ –∏ –∑–∞—á–µ–º?

### –ß—Ç–æ —Ç–∞–∫–æ–µ SQL –º–∏–≥—Ä–∞—Ü–∏—è?

SQL –º–∏–≥—Ä–∞—Ü–∏—è - —ç—Ç–æ –Ω–∞–±–æ—Ä SQL –∫–æ–º–∞–Ω–¥, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–∑–¥–∞—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (—Ç–∞–±–ª–∏—Ü—ã, —Ñ—É–Ω–∫—Ü–∏–∏, —Ç—Ä–∏–≥–≥–µ—Ä—ã, –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏).

### –ó–∞—á–µ–º –Ω—É–∂–Ω–∞ –Ω–∞—à–∞ –º–∏–≥—Ä–∞—Ü–∏—è?

–ù–∞—à–∞ –º–∏–≥—Ä–∞—Ü–∏—è (`SUPABASE_MIGRATION.sql`) –¥–µ–ª–∞–µ—Ç —Å–ª–µ–¥—É—é—â–µ–µ:

#### 1.1 –°–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É `profiles`

```sql
CREATE TABLE public.profiles (
  id UUID REFERENCES auth.users(id) ON DELETE CASCADE PRIMARY KEY,
  email TEXT,
  first_name TEXT,
  last_name TEXT,
  avatar_url TEXT,
  role TEXT DEFAULT 'user',
  ...
);
```

**–ó–∞—á–µ–º?**
- Supabase –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É `auth.users` –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –ù–æ –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–∏–º—è, –∞–≤–∞—Ç–∞—Ä, —Ä–æ–ª—å) –Ω—É–∂–Ω–∞ —Å–≤–æ—è —Ç–∞–±–ª–∏—Ü–∞ `profiles`
- –¢–∞–±–ª–∏—Ü–∞ —Å–≤—è–∑–∞–Ω–∞ —Å `auth.users` —á–µ—Ä–µ–∑ `id` (–≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á)

#### 1.2 –í–∫–ª—é—á–∞–µ—Ç RLS (Row Level Security)

```sql
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;
```

**–ó–∞—á–µ–º?**
- –ë–µ–∑ RLS –ª—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å/–∏–∑–º–µ–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- RLS –≤–∫–ª—é—á–∞–µ—Ç –∑–∞—â–∏—Ç—É –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

#### 1.3 –°–æ–∑–¥–∞–µ—Ç –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```sql
CREATE POLICY "Users can view own profile"
  ON public.profiles
  FOR SELECT
  USING (auth.uid() = id);
```

**–ó–∞—á–µ–º?**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å **—Ç–æ–ª—å–∫–æ —Å–≤–æ–π** –ø—Ä–æ—Ñ–∏–ª—å
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å **—Ç–æ–ª—å–∫–æ —Å–≤–æ–π** –ø—Ä–æ—Ñ–∏–ª—å
- `auth.uid()` - —ç—Ç–æ ID —Ç–µ–∫—É—â–µ–≥–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### 1.4 –°–æ–∑–¥–∞–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è

```sql
CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW EXECUTE FUNCTION public.handle_new_user();
```

**–ó–∞—á–µ–º?**
- –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è (—á–µ—Ä–µ–∑ OAuth –∏–ª–∏ Email/Password)
- Supabase –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ `auth.users`
- –ù–∞—à —Ç—Ä–∏–≥–≥–µ—Ä **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ `profiles`
- **–í–∞–º –Ω–µ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –≤—Ä—É—á–Ω—É—é!**

### –ö–∞–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é?

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Supabase Dashboard** ‚Üí –≤–∞—à –ø—Ä–æ–µ–∫—Ç
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SQL Editor** (–≤ –ª–µ–≤–æ–º –º–µ–Ω—é)
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å –∫–æ–¥ –∏–∑ `docs/implementation/SUPABASE_MIGRATION.sql`
4. –í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor
5. –ù–∞–∂–º–∏—Ç–µ **"Run"** –∏–ª–∏ **Ctrl+Enter**
6. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `profiles` —Å–æ–∑–¥–∞–Ω–∞
- ‚úÖ RLS –≤–∫–ª—é—á–µ–Ω
- ‚úÖ –ü–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚úÖ –¢—Ä–∏–≥–≥–µ—Ä —Å–æ–∑–¥–∞–Ω (–ø—Ä–æ—Ñ–∏–ª–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

---

## 2. üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ - –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

### –ß—Ç–æ —Ç–∞–∫–æ–µ —Ç–æ–∫–µ–Ω—ã?

Supabase –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–≤–∞ —Ç–∏–ø–∞ —Ç–æ–∫–µ–Ω–æ–≤:
- **Access Token** - –∫–æ—Ä–æ—Ç–∫–æ–∂–∏–≤—É—â–∏–π (1 —á–∞—Å), –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤
- **Refresh Token** - –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏–π (30 –¥–Ω–µ–π), –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è access token

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ?

#### –®–∞–≥ 1: Middleware –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ

```typescript
// middleware.ts
export async function middleware(request: NextRequest) {
  // –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ—Å—Å–∏—é Supabase (–≤–∞–∂–Ω–æ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤)
  const response = await updateSession(request);
  ...
}
```

#### –®–∞–≥ 2: `updateSession` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–∫–µ–Ω—ã

```typescript
// lib/supabase/middleware.ts
export async function updateSession(request: NextRequest) {
  const supabase = createServerClient(...)
  
  // ‚ö° –í–û–¢ –≠–¢–ê –°–¢–†–û–ö–ê - –∫–ª—é—á–µ–≤–∞—è!
  await supabase.auth.getUser()
  
  return supabaseResponse
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–∏ `getUser()`?**

1. Supabase –ø—Ä–æ–≤–µ—Ä—è–µ—Ç access token –∏–∑ cookies
2. –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω **–≤–∞–ª–∏–¥–Ω—ã–π** ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω **–∏—Å—Ç–µ–∫** ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç refresh token
   - –ü–æ–ª—É—á–∞–µ—Ç –Ω–æ–≤—ã–π access token
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω –≤ cookies
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### –®–∞–≥ 3: –ù–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ cookies

```typescript
setAll(cookiesToSet) {
  cookiesToSet.forEach(({ name, value, options }) => {
    request.cookies.set(name, value)
    supabaseResponse.cookies.set(name, value, options) // ‚ö° –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã
  })
}
```

### –ü–æ–ª–Ω—ã–π —Ñ–ª–æ—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤:

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å ‚Üí /projects
   ‚Üì
2. Middleware –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
   ‚Üì
3. updateSession() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
   ‚Üì
4. supabase.auth.getUser() –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω
   ‚Üì
5. –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫? 
   ‚îú‚îÄ –ù–ï–¢ ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   ‚îî‚îÄ –î–ê ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç refresh token
            ‚Üì
            –ü–æ–ª—É—á–∞–µ—Ç –Ω–æ–≤—ã–π access token –æ—Ç Supabase
            ‚Üì
            –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ cookies –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
            ‚Üì
            –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   ‚Üì
6. –ó–∞–ø—Ä–æ—Å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è —Å –≤–∞–ª–∏–¥–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

‚úÖ **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–º–µ—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** - –Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –≤—ã–∑—ã–≤–∞—Ç—å refresh
‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ** - —Ç–æ–∫–µ–Ω—ã –≤ httpOnly cookies
‚úÖ **–ù–∞–¥–µ–∂–Ω–æ** - —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ

---

## 3. üîí RLS (Row Level Security) - –∑–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î

### –ß—Ç–æ —Ç–∞–∫–æ–µ RLS?

RLS (Row Level Security) - —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º PostgreSQL, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å—Ç—Ä–æ–∫–∞–º —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

#### –ë–µ–∑ RLS (–æ–ø–∞—Å–Ω–æ!):

```sql
-- –õ—é–±–æ–π –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç:
SELECT * FROM profiles; -- –í–∏–¥–∏—Ç –í–°–ï –ø—Ä–æ—Ñ–∏–ª–∏
UPDATE profiles SET role = 'admin' WHERE id = '...'; -- –ú–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –ª—é–±–æ–π –ø—Ä–æ—Ñ–∏–ª—å
```

#### –° RLS (–±–µ–∑–æ–ø–∞—Å–Ω–æ):

```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç:
SELECT * FROM profiles; -- –í–∏–¥–∏—Ç –¢–û–õ–¨–ö–û —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å (id = auth.uid())
UPDATE profiles SET role = 'admin' WHERE id = '...'; -- –ú–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –¢–û–õ–¨–ö–û —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å
```

### –ù–∞—à–∏ –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

#### 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å:

```sql
CREATE POLICY "Users can view own profile"
  ON public.profiles
  FOR SELECT
  USING (auth.uid() = id);
```

**–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- `auth.uid()` - ID —Ç–µ–∫—É—â–µ–≥–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `id` - ID –ø—Ä–æ—Ñ–∏–ª—è –≤ —Ç–∞–±–ª–∏—Ü–µ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Ç–µ —Å—Ç—Ä–æ–∫–∏, –≥–¥–µ `auth.uid() = id`

#### 2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å:

```sql
CREATE POLICY "Users can update own profile"
  ON public.profiles
  FOR UPDATE
  USING (auth.uid() = id);
```

#### 3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å:

```sql
CREATE POLICY "Users can insert own profile"
  ON public.profiles
  FOR INSERT
  WITH CHECK (auth.uid() = id);
```

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã RLS:

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A (id: `abc-123`) –ø—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–æ—á–∏—Ç–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è B (id: `xyz-789`)

```typescript
// –í –∫–æ–¥–µ:
const { data } = await supabase
  .from('profiles')
  .select('*')
  .eq('id', 'xyz-789') // –ü—ã—Ç–∞–µ–º—Å—è –ø—Ä–æ—á–∏—Ç–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ó–∞–ø—Ä–æ—Å –¥–æ—Ö–æ–¥–∏—Ç –¥–æ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
2. RLS –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: `auth.uid() = 'abc-123'`, –Ω–æ `id = 'xyz-789'`
3. –£—Å–ª–æ–≤–∏–µ `auth.uid() = id` –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
4. **–ó–∞–ø—Ä–æ—Å –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è** - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A –Ω–µ –≤–∏–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è B

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ RLS:

‚úÖ **–ó–∞—â–∏—Ç–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î** - –¥–∞–∂–µ –µ—Å–ª–∏ –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –æ—à–∏–±–∫–æ–π, –¥–∞–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** - –Ω–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤ –∫–æ–¥–µ
‚úÖ **–ù–∞–¥–µ–∂–Ω–æ** - –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏ —á–µ—Ä–µ–∑ –ø—Ä—è–º–æ–π SQL –∑–∞–ø—Ä–æ—Å

---

## 4. üë§ –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

### –£ –≤–∞—Å —Å–µ–π—á–∞—Å –Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ!

**–î–∞, –≤—ã –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç —á–µ—Ä–µ–∑ sign up!**

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π?

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Email/Password

**–®–∞–≥ 1:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É –Ω–∞ `/signup` (–µ—Å–ª–∏ —Å–æ–∑–¥–∞–¥–∏—Ç–µ —Ç–∞–∫—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É)

```typescript
const { data, error } = await supabase.auth.signUp({
  email: 'user@example.com',
  password: 'secure-password',
})
```

**–®–∞–≥ 2:** Supabase –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ `auth.users`
- ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç email –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç —Å–µ—Å—Å–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–®–∞–≥ 3:** –ù–∞—à —Ç—Ä–∏–≥–≥–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ `profiles` —Ç–∞–±–ª–∏—Ü–µ
- ‚úÖ –ö–æ–ø–∏—Ä—É–µ—Ç email –∏–∑ `auth.users`
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ä–æ–ª—å `'user'` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω –∏ –º–æ–∂–µ—Ç –≤–æ–π—Ç–∏!

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ OAuth (Google, GitHub)

**–®–∞–≥ 1:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "Continue with Google"

```typescript
await supabase.auth.signInWithOAuth({
  provider: 'google',
  options: {
    redirectTo: `${window.location.origin}/auth/callback`,
  },
})
```

**–®–∞–≥ 2:** –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí Google ‚Üí Supabase ‚Üí `/auth/callback`

**–®–∞–≥ 3:** –í `/auth/callback`:

```typescript
// app/auth/callback/route.ts
const { data, error } = await supabase.auth.exchangeCodeForSession(code)
```

**–®–∞–≥ 4:** Supabase –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email –≤ `auth.users`
  - **–ï—Å–ª–∏ –ù–ï–¢** ‚Üí —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - **–ï—Å–ª–∏ –î–ê** ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç —Å–µ—Å—Å–∏—é

**–®–∞–≥ 5:** –ù–∞—à —Ç—Ä–∏–≥–≥–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- ‚úÖ –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–æ–≤—ã–π ‚Üí —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ `profiles`
- ‚úÖ –ö–æ–ø–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ Google (–∏–º—è, –∞–≤–∞—Ç–∞—Ä, email)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ —á–µ—Ä–µ–∑ OAuth!

### –ù—É–∂–Ω–æ –ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤—Ä—É—á–Ω—É—é –≤ Dashboard?

**–ù–ï–¢!** –í–∞–º –Ω–µ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤—Ä—É—á–Ω—É—é.

**–ò—Å–∫–ª—é—á–µ–Ω–∏—è (–∫–æ–≥–¥–∞ –º–æ–∂–µ—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è):**
- –¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏
- –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –¥—Ä—É–≥–æ–π —Å–∏—Å—Ç–µ–º—ã

### –ü–æ–ª–Ω—ã–π —Ñ–ª–æ—É —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è/–≤—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ OAuth
   ‚Üì
2. Supabase —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ auth.users
   ‚Üì
3. –ù–∞—à —Ç—Ä–∏–≥–≥–µ—Ä on_auth_user_created —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
   ‚Üì
4. –§—É–Ω–∫—Ü–∏—è handle_new_user() –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
   ‚Üì
5. –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ profiles —Ç–∞–±–ª–∏—Ü–µ
   ‚Üì
6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤–æ–π—Ç–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏?

**–í Supabase Dashboard:**
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Authentication** ‚Üí **Users**
2. –¢–∞–º –±—É–¥—É—Ç –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (—Å–æ–∑–¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ sign up –∏–ª–∏ OAuth)

**–í –∫–æ–¥–µ:**
```typescript
const supabase = await createClient()
const { data: { users } } = await supabase.auth.admin.listUsers()
// ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç Service Role Key
```

---

## üìã –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí /signup –∏–ª–∏ "Continue with Google"
   ‚Üì
2. Supabase Auth ‚Üí —Å–æ–∑–¥–∞–µ—Ç auth.users
   ‚Üì
3. –¢—Ä–∏–≥–≥–µ—Ä ‚Üí —Å–æ–∑–¥–∞–µ—Ç profiles (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
   ‚Üì
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –º–æ–∂–µ—Ç –≤–æ–π—Ç–∏
```

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí /login –∏–ª–∏ OAuth
   ‚Üì
2. Supabase Auth ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç credentials
   ‚Üì
3. –°–æ–∑–¥–∞–µ—Ç —Å–µ—Å—Å–∏—é ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–∫–µ–Ω—ã –≤ cookies
   ‚Üì
4. Middleware ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–∫–µ–Ω—ã –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
   ‚Üì
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∑–∞—â–∏—â–µ–Ω–Ω—ã–º –º–∞—Ä—à—Ä—É—Ç–∞–º
```

### –ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö:

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ API
   ‚Üì
2. API ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Supabase —Ç–æ–∫–µ–Ω
   ‚Üì
3. Supabase ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω
   ‚Üì
4. RLS ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
   ‚Üì
5. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã

1. ‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL –º–∏–≥—Ä–∞—Ü–∏—é (—Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É profiles –∏ RLS)
2. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (Google, GitHub)
3. ‚úÖ –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ sign up –∏–ª–∏ OAuth
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø—Ä–æ—Ñ–∏–ª—å —Å–æ–∑–¥–∞–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
5. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é

**–ì–æ—Ç–æ–≤–æ!** –¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏ –≤—Ö–æ–¥–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏! üéâ

