# –®–∞–≥–∏ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Supabase Auth

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ

1. ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ `@supabase/supabase-js` –∏ `@supabase/ssr`
2. ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Supabase –∫–ª–∏–µ–Ω—Ç–æ–≤:
   - `lib/supabase/client.ts` - –¥–ª—è Client Components
   - `lib/supabase/server.ts` - –¥–ª—è Server Components
   - `lib/supabase/middleware.ts` - –¥–ª—è Middleware
   - `lib/supabase/admin.ts` - –¥–ª—è Admin –æ–ø–µ—Ä–∞—Ü–∏–π
   - `lib/supabase/types.ts` - —Ç–∏–ø—ã –¥–ª—è Database
   - `lib/supabase/auth.ts` - —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
3. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `middleware.ts` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Supabase
4. ‚úÖ –°–æ–∑–¥–∞–Ω `app/auth/callback/route.ts` –¥–ª—è OAuth callback
5. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `AuthProvider` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Supabase
6. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ–≥–∏–Ω–∞ —Å OAuth –∫–Ω–æ–ø–∫–∞–º–∏
7. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã API routes (`/api/auth/login`, `/api/auth/logout`, `/api/auth/me`)
8. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π API route –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Supabase —Ç–æ–∫–µ–Ω–æ–≤
9. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `app/layout.tsx` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Supabase
10. ‚úÖ –°–æ–∑–¥–∞–Ω SQL —Ñ–∞–π–ª –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü—ã `profiles`

---

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤—Ä—É—á–Ω—É—é

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase –∏ Google OAuth

–°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ `docs/implementation/SUPABASE_SETUP_GUIDE.md`:

1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤ Supabase Dashboard
2. –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á–∏ (URL, anon key, service role key)
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Google OAuth –≤ Google Cloud Console
4. –î–æ–±–∞–≤—å—Ç–µ Google –ø—Ä–æ–≤–∞–π–¥–µ—Ä –≤ Supabase Dashboard
5. –í–∫–ª—é—á–∏—Ç–µ Email –ø—Ä–æ–≤–∞–π–¥–µ—Ä –≤ Supabase

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.local` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
# Supabase (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ)
NEXT_PUBLIC_SUPABASE_URL=https://<your-project-ref>.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=<your-anon-key>

# Service Role Key (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π)
# –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ, –µ—Å–ª–∏ –Ω—É–∂–Ω—ã –∞–¥–º–∏–Ω—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
# SUPABASE_SERVICE_ROLE_KEY=<your-service-role-key>

# –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
NEXT_PUBLIC_SITE_URL=http://localhost:3000
```

‚ö†Ô∏è **–í–∞–∂–Ω–æ**: 
- –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env.local` –≤ Git!
- Service Role Key **–ù–ï –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω** –¥–ª—è –±–∞–∑–æ–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. `SUPABASE_SERVICE_ROLE_KEY.md`

### –®–∞–≥ 3: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL –º–∏–≥—Ä–∞—Ü–∏–∏

1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard ‚Üí SQL Editor
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `docs/implementation/SUPABASE_MIGRATION.sql`
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∑–∞–ø—Ä–æ—Å
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ `profiles` —Å–æ–∑–¥–∞–Ω–∞ –∏ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

### –®–∞–≥ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä: `pnpm dev`
2. –û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:3000/login`
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ:
   - –í—Ö–æ–¥ —á–µ—Ä–µ–∑ Google OAuth
   - –í—Ö–æ–¥ —á–µ—Ä–µ–∑ Email/Password (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
   - –í—ã—Ö–æ–¥
   - –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã

---

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ GitHub OAuth

–ö–æ–≥–¥–∞ –±—É–¥–µ—Ç–µ –≥–æ—Ç–æ–≤—ã –¥–æ–±–∞–≤–∏—Ç—å GitHub:

1. –°–æ–∑–¥–∞–π—Ç–µ OAuth App –≤ GitHub Settings ‚Üí Developer settings
2. –ü–æ–ª—É—á–∏—Ç–µ Client ID –∏ Client Secret
3. –î–æ–±–∞–≤—å—Ç–µ –≤ Supabase Dashboard ‚Üí Authentication ‚Üí Providers ‚Üí GitHub

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Email —à–∞–±–ª–æ–Ω–æ–≤

–í Supabase Dashboard ‚Üí Authentication ‚Üí Email Templates –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:
- –®–∞–±–ª–æ–Ω—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email
- –®–∞–±–ª–æ–Ω—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è
- –ö–∞—Å—Ç–æ–º–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥—Ä—É–≥–∏—Ö OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

Supabase –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤:
- Microsoft/Azure AD
- Apple
- Discord
- –∏ –¥—Ä.

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞ Google/GitHub.

---

## üêõ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: "Invalid API key"

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä.

### –ü—Ä–æ–±–ª–µ–º–∞: OAuth —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ**: 
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ redirect URL –≤ Google Cloud Console —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å Supabase callback URL
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ Supabase Dashboard –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä

### –ü—Ä–æ–±–ª–µ–º–∞: Middleware —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ /login –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ

**–†–µ—à–µ–Ω–∏–µ**: 
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `/login` –≤ —Å–ø–∏—Å–∫–µ –ø—É–±–ª–∏—á–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ –≤ `middleware.ts`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Supabase cookies —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –ü—Ä–æ–±–ª–µ–º–∞: "Row Level Security policy violation"

**–†–µ—à–µ–Ω–∏–µ**: 
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ SQL –º–∏–≥—Ä–∞—Ü–∏—é
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ —Å–æ–∑–¥–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Supabase Auth Docs](https://supabase.com/docs/guides/auth)
- [Supabase SSR Guide](https://supabase.com/docs/guides/auth/server-side/nextjs)
- [Supabase RLS Guide](https://supabase.com/docs/guides/auth/row-level-security)
- [OAuth Providers Setup](https://supabase.com/docs/guides/auth/social-login)

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
2. –î–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –≤ UI
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ email —à–∞–±–ª–æ–Ω—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
4. –î–æ–±–∞–≤—å—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è)

---

## ‚ú® –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤** - Supabase —Å–∞–º —É–ø—Ä–∞–≤–ª—è–µ—Ç refresh —Ç–æ–∫–µ–Ω–∞–º–∏
2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - —Ç–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ httpOnly cookies
3. **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –º–µ–Ω—å—à–µ –∫–æ–¥–∞, –±–æ–ª—å—à–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
5. **RLS** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î

