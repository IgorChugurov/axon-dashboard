# ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Supabase –∑–∞–≤–µ—Ä—à–µ–Ω–∞

## üéØ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –£–¥–∞–ª–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Å—Ç–∞—Ä–æ–≥–æ Backend API

**–ë—ã–ª–æ:**

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `NEXT_PUBLIC_API_URL` –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –≤–Ω–µ—à–Ω–µ–º—É backend
- –¢–æ–∫–µ–Ω—ã –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∏—Å—å —á–µ—Ä–µ–∑ Bearer Authorization
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ —á–µ—Ä–µ–∑ `/api/auth/refresh-token`

**–°—Ç–∞–ª–æ:**

- –†–∞–±–æ—Ç–∞ –Ω–∞–ø—Ä—è–º—É—é —Å Supabase
- –¢–æ–∫–µ–Ω—ã —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ Supabase
- RLS –∑–∞—â–∏—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î

### 2. –°–æ–∑–¥–∞–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å –ø—Ä–æ–µ–∫—Ç–∞–º–∏ —á–µ—Ä–µ–∑ Supabase

**–ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:**

- `lib/projects/supabase.ts` - —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Supabase
- –û–±–Ω–æ–≤–ª–µ–Ω `lib/projects/server.ts` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Supabase –≤–º–µ—Å—Ç–æ —Å—Ç–∞—Ä–æ–≥–æ API
- –û–±–Ω–æ–≤–ª–µ–Ω `app/api/projects/route.ts` - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å Supabase

**–§—É–Ω–∫—Ü–∏–∏:**

- ‚úÖ `getProjectsFromSupabase()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –∏ –ø–æ–∏—Å–∫–æ–º
- ‚úÖ `createProjectInSupabase()` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ `updateProjectInSupabase()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ `deleteProjectFromSupabase()` - —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

### 3. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫

**–ü–∞–≥–∏–Ω–∞—Ü–∏—è:**

- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `page` –∏ `limit`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Supabase `.range(offset, offset + limit - 1)`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ: `total`, `totalPages`, `hasPreviousPage`, `hasNextPage`

**–ü–æ–∏—Å–∫:**

- –ü–∞—Ä–∞–º–µ—Ç—Ä: `search`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Supabase `.ilike("name", %search%)` –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –∏–º–µ–Ω–∏
- –†–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –ø–æ–∏—Å–∫

**–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:**

- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `sortBy` –∏ `sortOrder`
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `created_at DESC`

**–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è:**

- –ü–∞—Ä–∞–º–µ—Ç—Ä: `filters.status`
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### 4. –ü–æ–¥–∫–ª—é—á–µ–Ω logout –∫ Navbar –∏ Sidebar

**Navbar:**

- ‚úÖ –ö–Ω–æ–ø–∫–∞ logout –≤ dropdown –º–µ–Ω—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `useAuth().logout()`
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç loading —Å–æ—Å—Ç–æ—è–Ω–∏–µ

**Sidebar:**

- ‚úÖ –ö–Ω–æ–ø–∫–∞ logout –≤ footer dropdown
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `useAuth().logout()`
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ email

---

## üìä –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:

```typescript
// GET /api/projects?page=2&limit=10&search=test&sortBy=name&sortOrder=asc

const params = {
  page: 2,
  limit: 10,
  search: "test",
  sortBy: "name",
  sortOrder: "asc",
};

const result = await getProjectsFromSupabase(params);
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
// {
//   data: Project[],
//   pagination: {
//     page: 2,
//     limit: 10,
//     total: 50,
//     totalPages: 5,
//     hasPreviousPage: true,
//     hasNextPage: true
//   }
// }
```

### SQL –∑–∞–ø—Ä–æ—Å (—á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ Supabase):

```sql
SELECT *, count(*) OVER() as total
FROM projects
WHERE name ILIKE '%test%'
ORDER BY name ASC
LIMIT 10 OFFSET 10;
```

---

## üîí RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–æ–≤

### –ê–¥–º–∏–Ω—ã (admin –∏ superAdmin):

- ‚úÖ –í–∏–¥—è—Ç –í–°–ï –ø—Ä–æ–µ–∫—Ç—ã
- ‚úÖ –ú–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç—ã
- ‚úÖ –ú–æ–≥—É—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å –ª—é–±—ã–µ –ø—Ä–æ–µ–∫—Ç—ã
- ‚úÖ –ú–æ–≥—É—Ç —É–¥–∞–ª—è—Ç—å –ª—é–±—ã–µ –ø—Ä–æ–µ–∫—Ç—ã

### –û–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:

- ‚úÖ –í–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ –°–í–û–ò –ø—Ä–æ–µ–∫—Ç—ã (–≥–¥–µ `created_by = auth.uid()`)
- ‚úÖ –ú–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã
- ‚úÖ –ú–æ–≥—É—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã
- ‚úÖ –ú–æ–≥—É—Ç —É–¥–∞–ª—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
POST /api/projects
{
  "name": "My Project",
  "description": "Test project",
  "status": "active"
}
```

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π:

```bash
GET /api/projects?page=1&limit=10
```

### 3. –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏:

```bash
GET /api/projects?search=test&page=1&limit=10
```

### 4. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:

```bash
GET /api/projects?sortBy=name&sortOrder=asc
```

---

## ‚úÖ –ß—Ç–æ –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ

1. ‚ùå `NEXT_PUBLIC_API_URL` - –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
2. ‚ùå –°—Ç–∞—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ `getEntityDataFromBackend()` - –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ Supabase
3. ‚ùå `buildBackendUrl()` - –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–∞
4. ‚ùå `fetchFromBackend()` - –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–∞
5. ‚ùå `/api/auth/refresh-token` - Supabase –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–∫–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## üìù –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. ‚úÖ `lib/projects/supabase.ts` - –Ω–æ–≤—ã–π —Ñ–∞–π–ª –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Supabase
2. ‚úÖ `lib/projects/server.ts` - –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Supabase
3. ‚úÖ `lib/projects/types.ts` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–∏–ø—ã –ø–æ–¥ —Å—Ç—Ä—É–∫—Ç—É—Ä—É Supabase
4. ‚úÖ `app/api/projects/route.ts` - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å Supabase
5. ‚úÖ `components/ProjectsList.tsx` - –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
6. ‚úÖ `components/Navbar.tsx` - –ø–æ–¥–∫–ª—é—á–µ–Ω logout
7. ‚úÖ `components/AppSidebar.tsx` - –ø–æ–¥–∫–ª—é—á–µ–Ω logout

---

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–¢–µ–ø–µ—Ä—å –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–ø—Ä—è–º—É—é —Å Supabase:

- ‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è
- ‚úÖ –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏
- ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
- ‚úÖ RLS –∑–∞—â–∏—Ç–∞
- ‚úÖ Logout –≤ Navbar –∏ Sidebar
