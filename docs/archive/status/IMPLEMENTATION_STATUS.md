# –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

- ‚úÖ **Middleware** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤, —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login`
- ‚úÖ **Login** - `/api/auth/login` - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –±—ç–∫–µ–Ω–¥
- ‚úÖ **Logout** - `/api/auth/logout` - –≤—ã—Ö–æ–¥ –∏ –æ—á–∏—Å—Ç–∫–∞ cookies
- ‚úÖ **Refresh Token** - `/api/auth/refresh-token` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ **Get User** - `/api/auth/me` - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ **Utils** - `lib/auth/utils.ts` - —Ä–∞–±–æ—Ç–∞ —Å cookies (—á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å)

### 2. –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π API –¥–ª—è —Å—É—â–Ω–æ—Å—Ç–µ–π

- ‚úÖ **Route Handler** - `/api/[entity]` - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø—Ä–æ–∫—Å–∏ –¥–ª—è –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
- ‚úÖ **Handlers** - `lib/api/handlers.ts` - –æ–±—â–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –±—ç–∫–µ–Ω–¥–æ–º
- ‚úÖ **Server Functions** - `lib/api/server.ts` - —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è Server Components
- ‚úÖ **ServerDataProvider** - `lib/server-data/base.ts` - –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

### 3. –†–∞–±–æ—Ç–∞ —Å –ø—Ä–æ–µ–∫—Ç–∞–º–∏

- ‚úÖ **ProjectsServerProvider** - `lib/projects/server.ts` - –ø—Ä–æ–≤–∞–π–¥–µ—Ä –¥–ª—è –ø—Ä–æ–µ–∫—Ç–æ–≤
- ‚úÖ **ProjectsList** - `components/ProjectsList.tsx` - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤
- ‚úÖ **Projects Page** - `app/page.tsx` - –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –ø—Ä–æ–µ–∫—Ç–∞–º–∏

### 4. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã UI

- ‚úÖ **AuthProvider** - –∫–æ–Ω—Ç–µ–∫—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ **ThemeProvider** - –ø—Ä–æ–≤–∞–π–¥–µ—Ä —Ç–µ–º—ã
- ‚úÖ **Navbar** - –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å
- ‚úÖ **AppSidebar** - –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å
- ‚úÖ **UI Components** - button, input, select, sidebar, –∏ –¥—Ä.

### 5. –£—Ç–∏–ª–∏—Ç—ã

- ‚úÖ **lib/api.ts** - –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ **lib/utils.ts** - —Ñ—É–Ω–∫—Ü–∏—è `cn()` –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö)

## ‚ùå –ß—Ç–æ –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ / –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

### –ü—É—Å—Ç—ã–µ –ø–∞–ø–∫–∏ (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å):

1. ‚ùå `app/api/auth/clear-auth/` - –ø–∞–ø–∫–∞ –ø—É—Å—Ç–∞—è
2. ‚ùå `app/api/auth/set-tokens/` - –ø–∞–ø–∫–∞ –ø—É—Å—Ç–∞—è
3. ‚ùå `app/api/auth/refresh/` - –ø–∞–ø–∫–∞ –ø—É—Å—Ç–∞—è (–µ—Å—Ç—å `refresh-token/`)

### –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. ‚ùå `components/AuthErrorHandler.tsx` - –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
   - –†–µ–¥–∏—Ä–µ–∫—Ç —Ç–µ–ø–µ—Ä—å –¥–µ–ª–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `redirect()` –≤ Server Component
   - –ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è –±—É–¥—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

1. ‚ö†Ô∏è `ServerDataProvider.createData()` - –∑–∞–≥–ª—É—à–∫–∞
   - TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ `createEntityData()` –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ `getEntityData()`
   - –°–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è route handler `/api/[entity]` –¥–ª—è POST –∑–∞–ø—Ä–æ—Å–æ–≤

## üìã –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è GET –∑–∞–ø—Ä–æ—Å–æ–≤:

```
Server Component (app/page.tsx)
  ‚Üì
ProjectsServerProvider.getProjects()
  ‚Üì
ServerDataProvider.getData()
  ‚Üì
getEntityData() (lib/api/server.ts)
  ‚Üì
getEntityDataFromBackend() (lib/api/handlers.ts)
  ‚Üì
getAuthTokens() (lib/auth/utils.ts) - —á—Ç–µ–Ω–∏–µ cookies
  ‚Üì
fetch(—É–¥–∞–ª–µ–Ω–Ω—ã–π –±—ç–∫–µ–Ω–¥) - HTTP –∑–∞–ø—Ä–æ—Å
  ‚Üì
formatEntityResponse() - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
  ‚Üì
ServerDataProvider.formatResponse() - —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
  ‚Üì
–í–æ–∑–≤—Ä–∞—Ç –¥–∞–Ω–Ω—ã—Ö –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
```

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è POST –∑–∞–ø—Ä–æ—Å–æ–≤:

```
Client Component
  ‚Üì
fetch('/api/[entity]', { method: 'POST' })
  ‚Üì
Route Handler (app/api/[entity]/route.ts)
  ‚Üì
getEntityDataFromBackend() –∏–ª–∏ –ø—Ä—è–º–∞—è –ª–æ–≥–∏–∫–∞
  ‚Üì
fetch(—É–¥–∞–ª–µ–Ω–Ω—ã–π –±—ç–∫–µ–Ω–¥)
```

## üîß –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### lib/api/handlers.ts

- ‚úÖ `buildBackendUrl()` - –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ URL –∫ –±—ç–∫–µ–Ω–¥—É
- ‚úÖ `fetchFromBackend()` - –∑–∞–ø—Ä–æ—Å —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π 401 –∏ refresh
- ‚úÖ `getEntityDataFromBackend()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–∏
- ‚úÖ `formatEntityResponse()` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞

### lib/api/server.ts

- ‚úÖ `getEntityData()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è Server Components

### lib/api.ts

- ‚úÖ `api()` - –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤

### lib/auth/utils.ts

- ‚úÖ `getAuthTokens()` - —á—Ç–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –∏–∑ cookies
- ‚úÖ `getAuthUser()` - —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ `setAccessTokenCookie()` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ access token
- ‚úÖ `setRefreshTokenCookie()` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ refresh token
- ‚úÖ `clearAuthCookies()` - –æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö auth cookies
- ‚úÖ `hasRefreshToken()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è refresh token

### lib/server-data/base.ts

- ‚úÖ `getData()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- ‚ö†Ô∏è `createData()` - –∑–∞–≥–ª—É—à–∫–∞ (–Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
- ‚úÖ `formatResponse()` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞

### lib/utils.ts

- ‚úÖ `cn()` - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∫–ª–∞—Å—Å–æ–≤ –¥–ª—è Tailwind

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:

- ‚úÖ 15 —Ñ–∞–π–ª–æ–≤ –≤ `lib/`
- ‚úÖ 5 route handlers –≤ `app/api/`
- ‚úÖ 8+ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ `components/`
- ‚úÖ 1 middleware

### –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:

- ‚ùå 3 –ø—É—Å—Ç—ã–µ –ø–∞–ø–∫–∏
- ‚ùå 1 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (AuthErrorHandler)

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å:

1. –ü—É—Å—Ç—ã–µ –ø–∞–ø–∫–∏ –≤ `app/api/auth/`:

   - `clear-auth/`
   - `set-tokens/`
   - `refresh/` (–µ—Å–ª–∏ –Ω–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å)

2. `components/AuthErrorHandler.tsx` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ù—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:

1. `createEntityData()` –≤ `lib/api/server.ts` –¥–ª—è POST –∑–∞–ø—Ä–æ—Å–æ–≤
2. –û–±–Ω–æ–≤–∏—Ç—å `ServerDataProvider.createData()` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
